!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.zasi=e():t.zasi=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,r){window,t.exports=function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=10)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=2*Math.PI,a=void 0,s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=null}return r(t,null,[{key:"equals",value:function(t,e){return Math.abs(t-e)<=1e-5}},{key:"getDistance",value:function(t,e){var i=t.x-e.x,r=t.y-e.y,n=0;return null!=t.z&&null!=e.z&&(n=t.z-e.z),Math.sqrt(i*i+r*r+n*n)}},{key:"clamp",value:function(t,e,i){return t>i?i:t<e?e:t}},{key:"getInsance",value:function(){return null==this.instance&&(this.instance=new t),this.instance}},{key:"overlaps",value:function(t,e){var i=t,r=e;return i.left<=r.right&&i.right>=r.left&&i.bottom>=r.top&&i.top<=r.bottom}},{key:"isHit",value:function(e,i){var r=!1,n=e.left,a=e.top;return t.isInTheRect(n,a,i)&&(r=!0),n=e.left,a=e.top+e.height,t.isInTheRect(n,a,i)&&(r=!0),n=e.left+e.width,a=e.top,t.isInTheRect(n,a,i)&&(r=!0),n=e.left+e.width,a=e.top+e.height,t.isInTheRect(n,a,i)&&(r=!0),r||(n=i.left,a=i.top,t.isInTheRect(n,a,e)&&(r=!0),n=i.left,a=i.top+i.height,t.isInTheRect(n,a,e)&&(r=!0),n=i.left+i.width,a=i.top,t.isInTheRect(n,a,e)&&(r=!0),n=i.left+i.width,a=i.top+i.height,t.isInTheRect(n,a,e)&&(r=!0)),r}},{key:"isInTheRect",value:function(t,e,i){var r=i.left,n=i.top,a=i.width,s=i.height;return t>r&&t<r+a&&e>n&&e<n+s}},{key:"PI2",get:function(){return n}},{key:"EPSILON",get:function(){return 1e-5}},{key:"littleEndian",get:function(){if(void 0===a){var t=new ArrayBuffer(2),e=new Uint8Array(t),i=new Uint16Array(t);e[0]=170,e[1]=187,48042===i[0]&&(a=!0),43707===i[0]&&(a=!1)}return a}}]),t}();e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),a=i(0),s=(r=a)&&r.__esModule?r:{default:r},l=void 0,u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return n(t,null,[{key:"perspective2",value:function(t,e,i,r,n,a){return[2*n/(i-t),0,0,0,0,2*n/(e-r),0,0,(i+t)/(i-t),(r+e)/(e-r),(-n-a)/(a-n),-1,0,0,-n*a*2/(a-n),0]}},{key:"perspective3",value:function(e,i,r,n,a,s){var l=this.perspective(e,i/r,n,a,s),u=t.TEMP_MAT4[0];return t.translationMatrix(u,-i/2,-r/2,0),t.multiply(l,l,u),l}},{key:"isIdentity",value:function(t){return!(1!==t[0]||0!==t[1]||0!==t[2]||0!==t[3]||0!==t[4]||1!==t[5]||0!==t[6]||0!==t[7]||0!==t[8]||0!==t[9]||1!==t[10]||0!==t[11]||0!==t[12]||0!==t[13]||0!==t[14]||1!==t[15])}},{key:"perspective",value:function(t,e,i,r,n){var a=Math.tan(.5*Math.PI-.5*t);s.default.equals(a,1)&&(a=1);var l=1/(i-r),u=void 0;return null!=n?(this.identityMatrix(n),u=n):u=this.identity(),u[0]=a/e,u[5]=-a,u[10]=(i+r)*l,u[11]=-1,u[14]=i*r*l*2,u}},{key:"orthoProjection",value:function(t,e,i,r,n,a,s){return null!=s?(this.identityMatrix(s),s[0]=2/(i-t),s[5]=2/(e-r),s[10]=2/(n-a),s[12]=(t+i)/(t-i),s[13]=(r+e)/(r-e),s[14]=(n+a)/(n-a),s):new Float32Array([2/(i-t),0,0,0,0,2/(e-r),0,0,0,0,2/(n-a),0,(t+i)/(t-i),(r+e)/(r-e),(n+a)/(n-a),1])}},{key:"copy",value:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}},{key:"equals",value:function(t,e){var i=t[0],r=t[1],n=t[2],a=t[3],l=t[4],u=t[5],o=t[6],h=t[7],f=t[8],c=t[9],d=t[10],y=t[11],g=t[12],v=t[13],p=t[14],x=t[15],m=e[0],b=e[1],M=e[2],w=e[3],k=e[4],P=e[5],S=e[6],T=e[7],_=e[8],I=e[9],A=e[10],D=e[11],C=e[12],E=e[13],R=e[14],V=e[15];return Math.abs(i-m)<=s.default.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(r-b)<=s.default.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(n-M)<=s.default.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-w)<=s.default.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-k)<=s.default.EPSILON*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(u-P)<=s.default.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(o-S)<=s.default.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(h-T)<=s.default.EPSILON.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-_)<=s.default.EPSILON*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(c-I)<=s.default.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-A)<=s.default.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(y-D)<=s.default.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))&&Math.abs(g-C)<=s.default.EPSILON*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(v-E)<=s.default.EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(p-R)<=s.default.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(x-V)<=s.default.EPSILON*Math.max(1,Math.abs(x),Math.abs(V))}},{key:"exactEquals",value:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}},{key:"projection",value:function(t,e,i){var r=this.identity();return r[0]=2/t,r[5]=-2/e,r[10]=2/i,r[12]=-1,r[13]=1,r[15]=1,r}},{key:"identity",value:function(){var t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}},{key:"identityMatrix",value:function(t){var e=t;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}},{key:"translationMatrix",value:function(t,e,i,r){var n=t;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e,n[13]=i,n[14]=r,n[15]=1}},{key:"translation",value:function(t,e,i){var r=this.identity();return r[12]=t,r[13]=e,r[14]=i,r}},{key:"rotationZMatrix",value:function(t,e){var i=t;i[2]=0,i[3]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1;var r=Math.cos(e),n=Math.sin(e);i[0]=r,i[1]=n,i[4]=-n,i[5]=r}},{key:"rotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t),r=this.identity();return r[0]=e,r[1]=i,r[4]=-i,r[5]=e,r}},{key:"rotationXMatrix",value:function(t,e){var i=t;i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[7]=0,i[8]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1;var r=Math.cos(e),n=Math.sin(e);i[5]=r,i[6]=n,i[9]=-n,i[10]=r}},{key:"rotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t),r=this.identity();return r[5]=e,r[6]=i,r[9]=-i,r[10]=e,r}},{key:"rotationYMatrix",value:function(t,e){var i=t;i[1]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1;var r=Math.cos(e),n=Math.sin(e);i[0]=r,i[2]=-n,i[8]=n,i[10]=r}},{key:"rotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t),r=this.identity();return r[0]=e,r[2]=-i,r[8]=i,r[10]=e,r}},{key:"scalingMatrix",value:function(t,e,i,r){var n=t;n[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}},{key:"scaling",value:function(t,e,i){var r=this.identity();return r[0]=t,r[5]=e,r[10]=i,r}},{key:"multiplyWithVertex",value:function(t,e,i){var r=t[0],n=t[1],a=t[2],s=t[3],l=t[4],u=t[5],o=t[6],h=t[7],f=t[8],c=t[9],d=t[10],y=t[11],g=t[12],v=t[13],p=t[14],x=t[15],m=e[0],b=e[1],M=e[2],w=e[3];return null==M&&(M=0),null==w&&(w=1),i[0]=m*r+b*l+M*f+w*g,i[1]=m*n+b*u+M*c+w*v,i[2]=m*a+b*o+M*d+w*p,i[3]=m*s+b*h+M*y+w*x,i}},{key:"multiply",value:function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],l=e[4],u=e[5],o=e[6],h=e[7],f=e[8],c=e[9],d=e[10],y=e[11],g=e[12],v=e[13],p=e[14],x=e[15],m=i[0],b=i[1],M=i[2],w=i[3];return t[0]=m*r+b*l+M*f+w*g,t[1]=m*n+b*u+M*c+w*v,t[2]=m*a+b*o+M*d+w*p,t[3]=m*s+b*h+M*y+w*x,m=i[4],b=i[5],M=i[6],w=i[7],t[4]=m*r+b*l+M*f+w*g,t[5]=m*n+b*u+M*c+w*v,t[6]=m*a+b*o+M*d+w*p,t[7]=m*s+b*h+M*y+w*x,m=i[8],b=i[9],M=i[10],w=i[11],t[8]=m*r+b*l+M*f+w*g,t[9]=m*n+b*u+M*c+w*v,t[10]=m*a+b*o+M*d+w*p,t[11]=m*s+b*h+M*y+w*x,m=i[12],b=i[13],M=i[14],w=i[15],t[12]=m*r+b*l+M*f+w*g,t[13]=m*n+b*u+M*c+w*v,t[14]=m*a+b*o+M*d+w*p,t[15]=m*s+b*h+M*y+w*x,t}},{key:"inverse",value:function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],l=e[5],u=e[6],o=e[7],h=e[8],f=e[9],c=e[10],d=e[11],y=e[12],g=e[13],v=e[14],p=e[15],x=i*l-r*s,m=i*u-n*s,b=i*o-a*s,M=r*u-n*l,w=r*o-a*l,k=n*o-a*u,P=h*g-f*y,S=h*v-c*y,T=h*p-d*y,_=f*v-c*g,I=f*p-d*g,A=c*p-d*v,D=x*A-m*I+b*_+M*T-w*S+k*P;return D?(D=1/D,t[0]=(l*A-u*I+o*_)*D,t[1]=(n*I-r*A-a*_)*D,t[2]=(g*k-v*w+p*M)*D,t[3]=(c*w-f*k-d*M)*D,t[4]=(u*T-s*A-o*S)*D,t[5]=(i*A-n*T+a*S)*D,t[6]=(v*b-y*k-p*m)*D,t[7]=(h*k-c*b+d*m)*D,t[8]=(s*I-l*T+o*P)*D,t[9]=(r*T-i*I-a*P)*D,t[10]=(y*w-g*b+p*x)*D,t[11]=(f*b-h*w-d*x)*D,t[12]=(l*S-s*_-u*P)*D,t[13]=(i*_-r*S+n*P)*D,t[14]=(g*m-y*M-v*x)*D,t[15]=(h*M-f*m+c*x)*D,t):null}},{key:"TEMP_MAT4",get:function(){return null==l&&(l=[t.identity(),t.identity(),t.identity(),t.identity()]),l}},{key:"EPSILON",get:function(){return s.default.EPSILON}}]),t}();e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),a=i(0),s=(r=a)&&r.__esModule?r:{default:r},l=void 0,u=function(){function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.value=new Float32Array(4),this.x=e||0,this.y=i||0,this.z=r||0,this.value[3]=1}return n(t,[{key:"x",get:function(){return this.value[0]},set:function(t){this.value[0]=t}},{key:"y",get:function(){return this.value[1]},set:function(t){this.value[1]=t}},{key:"z",get:function(){return this.value[2]},set:function(t){this.value[2]=t}},{key:"magnitude",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}}],[{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"normalize",value:function(t,e){var i=e.magnitude;s.default.equals(0,i)?(t.x=0,t.y=0,t.z=0):(t.x=e.x/i,t.y=e.y/i,t.z=e.z/i)}},{key:"plus",value:function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t}},{key:"multiplyValue",value:function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t}},{key:"copy",value:function(t,e){e.x=t.x,e.y=t.y,e.z=t.z}},{key:"cross",value:function(t,e,i){return t.x=e.y*i.z-e.z*i.y,t.y=e.z*i.x-e.x*i.z,t.z=e.x*i.y-e.y*i.x,t}},{key:"TEMP_VECTORS",get:function(){return null==l&&(l=[new t,new t,new t,new t]),l}}]),t}();e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=l(i(2)),a=l(i(6)),s=l(i(4));function l(t){return t&&t.__esModule?t:{default:t}}l(i(0));var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"getProjectionPointOnLine",value:function(t,e,i){var r=s.default.TEMP_VECTORS[0];r.x=i.x-e.x,r.y=i.y-e.y,s.default.normalize(r,r);var n=s.default.TEMP_VECTORS[1];n.x=t.x-e.x,n.y=t.y-e.y;var a=s.default.dot(n,r);s.default.multiplyValue(r,r,a);var l={x:0,y:0};return s.default.plus(l,r,e),l}},{key:"cubicBezier",value:function(t,e,i,r,n,a,s,l,u,o){var h=1-t,f=h*h*h*e;f+=3*h*h*t*r,f+=3*h*t*t*a,f+=t*t*t*l;var c=h*h*h*i;return c+=3*h*h*t*n,c+=3*h*t*t*s,c+=t*t*t*u,(o=o||[0,0])[0]=f,o[1]=c,o}},{key:"quadraticBezier",value:function(t,e,i,r,n,a,s,l){var u=1-t,o=u*u*e;o+=2*u*t*r,o+=t*t*a,(l=l||[0,0])[0]=o;var h=u*u*i;return h+=2*u*t*n,h+=t*t*s,l[1]=h,l}},{key:"arcConversionEndpointToCenter",value:function(t,e,i,r,n,l,u){var o=[(t-i)/2,(e-r)/2,1],h=a.default.TEMP_MAT3[0];0!=u&&(a.default.rotate(h,-u),a.default.multiplyWithVertex(h,h,o),o[0]=h[0],o[1]=h[1]);var f=n*n*l*l/(n*n*o[1]*o[1]+l*l*o[0]*o[0]);if((f=Math.abs(f-1))<0)throw new Error("radius is small, the ellipse does not across these two points");var c=Math.sqrt(f);c*=1;var d=[n*o[1]/l,-l*o[0]/n,0];d[0]*=c,d[1]*=c;var y=[d[0],d[1],1];0!=u&&(a.default.rotate(h,u),a.default.multiplyWithVertex(h,h,y));var g=y[0]+(t+i)/2,v=y[1]+(e+r)/2,p=s.default.TEMP_VECTORS[0];p.x=1,p.y=0;var x=s.default.TEMP_VECTORS[1];x.x=(o[0]-d[0])/n,x.y=(o[1]-d[1])/l;var m=Math.abs(Math.acos(s.default.dot(p,x)/(p.magnitude*x.magnitude)));p.x*x.y<0&&(m*=-1),p.x=(-o[0]-d[0])/n,p.y=(-o[1]-d[1])/l;var b=Math.acos(s.default.dot(p,x)/(p.magnitude*x.magnitude));return{x:g,y:v,theta:m,deltaTheta:b=Math.abs(b%(2*Math.PI))}}},{key:"getEllipsePointWithRadian",value:function(t,e,i,r,s,l,u){u=u||[0,0];var o=n.default.TEMP_VECTORS[0];if(o.x=i*Math.cos(s),o.y=r*Math.sin(s),o.z=0,0!=l){var h=a.default.TEMP_MAT3[0];a.default.rotate(h,l),a.default.multiplyWithVertex(h,h,o.value),o.x=h[0],o.y=h[1]}return u[0]=o.x+t,u[1]=o.y+e,u}},{key:"calculateIntersectionOfPlane",value:function(t,e,i,r,a,s){var l=n.default.dot(t,e);if(0==Math.abs(l))return null;var u=n.default.TEMP_VECTORS[0];u.x=r.x-i.x,u.y=r.y-i.y,u.z=r.z-i.z;var o=n.default.dot(u,t)/l,h=o>0?1:-1,f=o;null!=s&&Math.abs(o)>s&&(f=s*h),o=f,n.default.multiplyValue(u,e,o),n.default.plus(a,u,i)}},{key:"calculateIntersectionOfTowLines",value:function(t,e,i,r){var n=t.x,a=t.y,s=e.x,l=e.y,u=i.x,o=i.y,h=r.x,f=r.y,c=(n-s)*(o-f)-(a-l)*(u-h);if(0!=c){var d=(n*l-a*s)*(u-h)-(n-s)*(u*f-o*h),y=(n*l-a*s)*(o-f)-(a-l)*(u*f-o*h);return{x:d/=c,y:y/=c}}}}]),t}();e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),a=i(0),s=(r=a)&&r.__esModule?r:{default:r},l=Symbol("二维向量值数组,0是x，1是y"),u=void 0,o=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[l]=new Float32Array(3),null==e&&null==e||(this.x=e),null==i&&null==i||(this.y=i),this[l][2]=1}return n(t,[{key:"x",get:function(){return this[l][0]},set:function(t){this[l][0]=t}},{key:"y",get:function(){return this[l][1]},set:function(t){this[l][1]=t}},{key:"value",get:function(){return this[l]},set:function(t){this[l][0]=t[0],this[l][1]=t[1]}},{key:"radian",get:function(){return Math.atan2(this.y,this.x)}},{key:"magnitude",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}],[{key:"rotate",value:function(t,e,i){var r=Math.cos(i),n=Math.sin(i);t||(t={x:0,y:0});var a=e.x*n+e.y*r,s=e.x*r-e.y*n;return t.x=s,t.y=a,t}},{key:"rotateAbout",value:function(t,e,i,r){var n=Math.cos(r),a=Math.sin(r);return t||(t={}),t.x=i.x+((e.x-i.x)*n-(e.y-i.y)*a),t.y=i.y+((e.x-i.x)*a+(e.y-i.y)*n),t}},{key:"normalize",value:function(t,e){var i=e.magnitude;return null==t?t=e.clone():t!=e&&(t.x=e.x,t.y=e.y),0==i?(t.x=0,t.y=0,t):(t.x=t.x/i,t.y=t.y/i,t)}},{key:"multiplyValue",value:function(t,e,i){var r=e.x*i,n=e.y*i;t.x=r,t.y=n}},{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"cross",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"crossZ",value:function(t,e,i){return t.x=e.y*i,t.y=-e.x*i,t}},{key:"zCrossVector",value:function(t,e,i){return t.x=-e*i.y,t.y=e*i.x,t}},{key:"plus",value:function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t}},{key:"sub",value:function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t}},{key:"TEMP_VECTORS",get:function(){return null==u&&(u=[new t(0,0),new t(0,0),new t(0,0),new t(0,0)]),u}}]),n(t,[{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"subtract",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"multiply",value:function(t){return this.x*=t,this.y*=t,this}},{key:"split",value:function(e,i){var r=Math.max(e,i),n=Math.min(e,i);console.log(r,n);var a=Math.PI-(r-n),s=this.magnitude/Math.sin(a),l=r-this.radian,u=Math.PI-l-a,o=s*Math.sin(u),h=s*Math.sin(l),f=t.createVector(h,n),c=t.createVector(o,r);f.add(c)}},{key:"splitWithRightAngle",value:function(e){this.rotate(-e);var i=new t(this.x,0),r=new t(0,this.y);return i.rotate(e),r.rotate(e),this.rotate(e),{hVector:i,vVector:r}}},{key:"reverse",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"rotate",value:function(t){var e=this.radian+t,i=this.magnitude;this.x=Math.abs(i)*Math.cos(e),this.y=Math.abs(i)*Math.sin(e)}},{key:"clone",value:function(){return new t(this.x,this.y)}}],[{key:"createVector",value:function(e,i){var r=Math.abs(e)*Math.cos(i);Math.abs(r)<s.default.EPSILON&&(r=0);var n=Math.abs(e)*Math.sin(i);return Math.abs(n)<s.default.EPSILON&&(n=0),new t(r,n)}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=l(i(2)),a=l(i(3)),s=l(i(0));function l(t){return t&&t.__esModule?t:{default:t}}var u=new n.default(0,0,0),o=new n.default(0,0,0),h=new Float32Array(1),f=new n.default,c=new n.default(0,0,0),d=new n.default(0,0,0),y=new n.default(0,0,0),g=new n.default(0,0,0),v=new n.default(0,0,0),p=new n.default(0,0,0),x=new n.default(0,0,0),m=new n.default(0,0,0),b=new n.default(0,0,0),M=new n.default(0,0,0),w=new n.default(0,0,0),k=new n.default(0,0,0),P=new n.default(0,0,0),S=new n.default(0,0,0),T=new n.default(0,0,0),_=new n.default(0,0,0),I=new n.default(0,0,0),A=new n.default,D=new n.default(0,0,0),C=new n.default(0,0,0),E=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"generateRectanglesPoints",value:function(t,e,i,r,s){null==t&&(t=1);var l=(r=r||{}).setPoint,C=r.addPoint,E=[];if(null==l&&(l=function(t,e){E[e*=3]=t.x,E[e+1]=t.y,E[e+2]=t.z}),null==C&&(C=function(t){E.push(t.x),E.push(t.y),E.push(t.z)}),h[0]=t/2,null==s||s.getPointsNum()<2)return 0;f.x=i[0],f.y=i[1],f.z=i[2];var R=s.getPointsNum(),V={r1:null,r2:null,r3:null,r4:null},O=R-1;n.default.normalize(f,f),e&&O++;for(var N=0;N<O;N++){u.x=s.getX(N),u.y=s.getY(N),u.z=s.getZ(N);var L=N+1;L>=R&&(L=0),o.x=s.getX(L),o.y=s.getY(L),o.z=s.getZ(L),D.x=o.x-u.x,D.y=o.y-u.y,D.z=o.z-u.z;var F=n.default.TEMP_VECTORS[0];n.default.cross(F,D,f),n.default.normalize(F,F),F.x*=h[0],F.y*=h[0],F.z*=h[0],n.default.plus(v,F,u),n.default.plus(p,F,o),F.x=-F.x,F.y=-F.y,F.z=-F.z,n.default.plus(x,F,o),n.default.plus(m,F,u);var B=V.r1,z=V.r4,j=V.r2,G=V.r3;null!=B&&this.updateConnectPoints(B,j,G,z,v,p,x,m,N,D,f,E,l),C(v,N,0),C(p,N,1),C(x,N,2),C(m,N,3),c.value[0]=v.value[0],c.value[1]=v.value[1],c.value[2]=v.value[2],d.value[0]=p.value[0],d.value[1]=p.value[1],d.value[2]=p.value[2],y.value[0]=x.value[0],y.value[1]=x.value[1],y.value[2]=x.value[2],g.value[0]=m.value[0],g.value[1]=m.value[1],g.value[2]=m.value[2],0==N&&(b.value[0]=v.value[0],b.value[1]=v.value[1],b.value[2]=v.value[2],M.value[0]=p.value[0],M.value[1]=p.value[1],M.value[2]=p.value[2],w.value[0]=x.value[0],w.value[1]=x.value[1],w.value[2]=x.value[2],k.value[0]=m.value[0],k.value[1]=m.value[1],k.value[2]=m.value[2]),N+1==O&&(P.value[0]=v.value[0],P.value[1]=v.value[1],P.value[2]=v.value[2],S.value[0]=p.value[0],S.value[1]=p.value[1],S.value[2]=p.value[2],T.value[0]=x.value[0],T.value[1]=x.value[1],T.value[2]=x.value[2],_.value[0]=m.value[0],_.value[1]=m.value[1],_.value[2]=m.value[2]),V.r1=c,V.r2=d,V.r3=y,V.r4=g}if(e){var U=4*O;I.x=S.x-P.x,I.y=S.y-P.y,I.z=S.z-P.z;var W=I;n.default.normalize(W,W);var q=n.default.TEMP_VECTORS[1];q.x=b.x-M.x,q.y=b.y-M.y,q.z=b.z-M.z;var Y=A;n.default.cross(Y,q,f),n.default.normalize(Y,Y);var X=n.default.TEMP_VECTORS[0];a.default.calculateIntersectionOfPlane(Y,W,S,M,X),null!=X&&(l(X,0),l(X,U-3)),W.x=T.x-_.x,W.y=T.y-_.y,W.z=T.z-_.z,n.default.normalize(W,W),a.default.calculateIntersectionOfPlane(Y,W,T,k,X),null!=X&&(l(X,3),l(X,U-2))}return 0==E.length?O:E}},{key:"setPointValue",value:function(t,e,i,r,n){n[r*=3]=t,n[r+1]=e,n[r+2]=i}},{key:"updateRectPoint",value:function(t,e,i,r,n){var a=1+(i*=4),s=a+1;null!=t&&n(t,a),null!=e&&n(e,s)}},{key:"updateConnectPoints",value:function(t,e,i,r,l,u,o,h,f,c,d,y,g){var v=2*s.default.getDistance(e,l),p=n.default.TEMP_VECTORS[0],x=I;x.x=e.x-t.x,x.y=e.y-t.y,x.z=e.z-t.z,n.default.normalize(x,x);var m=A;n.default.cross(m,c,d),n.default.normalize(m,m);var b=n.default.dot(m,x);if(Math.abs(b)<s.default.EPSILON)return l.x=e.x,l.y=e.y,l.z=e.z,h.x=i.x,h.y=i.y,void(h.z=i.z);a.default.calculateIntersectionOfPlane(m,x,e,l,C,v),null!=C&&(l.x=C.x,l.y=C.y,l.z=C.z),x.x=i.x-r.x,x.y=i.y-r.y,x.z=i.z-r.z,n.default.normalize(x,x),a.default.calculateIntersectionOfPlane(m,x,i,h,p,v),null!=p&&(h.x=p.x,h.y=p.y,h.z=p.z),this.updateRectPoint(C,p,f-1,y,g)}},{key:"addPoint",value:function(t,e){e.push(t.x),e.push(t.y),e.push(t.z)}}]),t}();e.default=E},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=void 0,a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"projection",value:function(t,e){var i=this.identity();return i[0]=2/t,i[4]=-2/e,i[6]=-1,i[7]=1,i[8]=1,i}},{key:"identity",value:function(t){return null==t?((t=new Float32Array(9))[0]=1,t[4]=1,t[8]=1):(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1),t}},{key:"translate",value:function(t,e,i){var r=void 0,n=void 0,a=void 0;return 3==arguments.length&&(a=t,this.identity(a),r=e,n=i),2==arguments.length&&(r=t,n=e,a=this.identity()),a[6]=r,a[7]=n,a}},{key:"rotate",value:function(t,e){var i=void 0,r=void 0;2==arguments.length&&(r=t,this.identity(r),i=e),1==arguments.length&&(i=t,r=this.identity());var n=Math.cos(i),a=Math.sin(i);return r[0]=n,r[1]=a,r[3]=-a,r[4]=n,r}},{key:"scale",value:function(t,e,i){var r=void 0,n=void 0,a=void 0;return 3==arguments.length&&(a=t,this.identity(a),r=e,n=i),2==arguments.length&&(r=t,n=e,a=this.identity()),a[0]=r,a[4]=n,a}},{key:"copy",value:function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]}},{key:"multiplyWithVertex",value:function(e,i,r){var n=void 0,a=void 0,s=void 0;3==arguments.length&&(n=i,a=e,s=r),2==arguments.length&&(n=e,s=i),null==a&&(a=t.identity());var l=n[0],u=n[1],o=n[2],h=n[3],f=n[4],c=n[5],d=n[6],y=n[7],g=n[8],v=s[0],p=s[1],x=s[2];return null==x&&(x=1),a[0]=v*l+p*h+x*d,a[1]=v*u+p*f+x*y,a[2]=v*o+p*c+x*g,a}},{key:"multiply",value:function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],l=e[4],u=e[5],o=e[6],h=e[7],f=e[8],c=i[0],d=i[1],y=i[2],g=i[3],v=i[4],p=i[5],x=i[6],m=i[7],b=i[8];return t[0]=c*r+d*s+y*o,t[1]=c*n+d*l+y*h,t[2]=c*a+d*u+y*f,t[3]=g*r+v*s+p*o,t[4]=g*n+v*l+p*h,t[5]=g*a+v*u+p*f,t[6]=x*r+m*s+b*o,t[7]=x*n+m*l+b*h,t[8]=x*a+m*u+b*f,t}},{key:"TEMP_MAT3",get:function(){return null==n&&(n=[t.identity(),t.identity(),t.identity(),t.identity()]),n}}]),t}();e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=s(i(23)),a=s(i(8));function s(t){return t&&t.__esModule?t:{default:t}}var l=Symbol("图片缓存"),u=Symbol("texture缓存"),o=Symbol("贴图表"),h=function(){function t(e,i,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxWidth=e||1,this.maxHeight=i||1,this.maxTextureNum=r||1,this[l]=[],this[u]=[],this[o]={},this.imageDataArray=new Array(this.maxTextureNum),this.textureArray=new Array(this.maxTextureNum),this.space=n||3}return r(t,[{key:"getMapLength",value:function(t){var e=0,i=void 0;for(i in t)t.hasOwnProperty(i)&&e++;return e}},{key:"getTexture",value:function(t,e,i){var r=this.imageCatch.indexOf(t);return-1==r?this.registerImageData(null,t,e,i):this[u][r]}},{key:"getTextureById",value:function(t,e){var i=this[o][t];return null!=e&&null!=i?i.splitedTextures[e]:i}},{key:"registerTexture",value:function(t,e,i,r,n,s){if(t=t||this.getMapLength(this[o]).toString(),null==i){if(null!=r){(i="undefined"!=typeof wx?wx.createImage():new Image).tid=t,i.crossOrigin="";var l=this;i.onload=function(t){var i=t.target,r=l.registerImageData(i.tid,i,e,!0);if(n){if(s){var u=s.column,o=s.row,h=o*u;h>1&&(r.splitedTextures.length=0);for(var f=i.width/u,c=i.height/o,d=0;d<h;d++){var y=Math.floor(d/u),g=Math.floor(d%u)*f,v=y*c,p=new a.default({id:i.tid+"_"+d,x:g+r.x,y:v+r.y,width:f,height:c,page:r.page});r.splitedTextures.push(p)}}n.success&&n.success(r)}},i.onerror=function(){n&&n.failed&&n.failed()},i.src=r}}else{var u=this.registerImageData(t,i,e,!0);n&&n.success&&n.success(u)}n&&n.complete&&n.complete()}},{key:"registerImageData",value:function(t,e,i,r){if(null!=e&&null!=e){null==r&&(r=!1);var s=0,l=0,h=e.width,f=e.height;if(h>this.maxWidth||f>this.maxHeight)throw new Error("图片大小超过了最大限制："+this.maxWidth+" x "+this.maxHeight);if(-1==this.imageCatch.indexOf(e)){var c=new n.default,d=c.getContext("2d");d.clearRect(0,0,c.width,c.height);for(var y=-1,g=0;g<this.imageDataArray.length;g++){var v=this.imageDataArray[g];if(null==v)v={imageData:void 0,startX:0,startY:0,width:0,height:0},this.imageDataArray[g]=v,c.width=e.width,c.height=e.height+1,s=0,l=1,d.fillStyle="#ffffff",d.fillRect(0,0,1,1),d.drawImage(e,0,1),v.imageData=d.getImageData(0,0,c.width,c.height),v.startX=c.width+this.space,v.startY=1,v.width=c.width,v.height=c.height;else{var p=e.width,x=e.height;if(s=v.startX,l=v.startY,s+p>this.maxWidth?(s=0,l=v.height+this.space,c.width=Math.max(v.width,p),c.height=l+x):(c.width=Math.max(v.width,s+p),c.height=Math.max(v.height,l+x)),l+x>this.maxHeight){console.error("图片超过贴图内存最大尺寸");continue}d.putImageData(v.imageData,0,0),d.drawImage(e,s,l),v.imageData=d.getImageData(0,0,c.width,c.height),v.startX=s+p+this.space,v.startY=l,v.width=c.width,v.height=c.height}y=g;break}if(-1!=y){this.imageCatch.push(e);var m=new a.default;return m.id=t,m.x=s,m.y=l,m.width=h,m.height=f,m.page=y,r&&this.createTexture(i,y,c),this[o][t]=m,this[u].push(m),m}}}else console.error("Image can not be null")}},{key:"createAllTexture",value:function(t){if(null!=t)for(var e=new n.default,i=0;i<this.textureArray.length;i++)this.createTexture(t,i,e)}},{key:"createTexture",value:function(e,i,r){if(null!=e&&null!=i&&-1!=i){null==r&&(r=new n.default);var a=r.getContext("2d"),s=this.textureArray[i],l=this.imageDataArray[i];null!=l&&(r.width=l.width,r.height=l.height,a.putImageData(l.imageData,0,0),null==s&&(s=e.createTexture(),this.textureArray[i]=s),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),t.isPOT(r.width)&&t.isPOT(r.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null))}}},{key:"cleanImageData",value:function(){this.imageCatch.length=0;for(var t=0;t<this.imageDataArray.length;t++){var e=this.imageDataArray[t];e&&(e.imageData=null)}}},{key:"imageCatch",get:function(){return this[l]}}],[{key:"isPOT",value:function(t){return t>0&&0==(t-1&t)}}]),t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.id=e.id,null!=e.x?this.x=e.x:this.x=-1,null!=e.y?this.y=e.y:this.y=-1,null!=e.width?this.width=e.width:this.width=-1,null!=e.height?this.height=e.height:this.height=-1,this.page=e.page||0,this.index=this.page,this.splitedTextures=[]}return r(t,[{key:"index",get:function(){return this.page},set:function(t){this.page=t}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=void 0,a=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.singleDataByteLength=i,this.buffer=new ArrayBuffer(e*i),this.dv=new DataView(this.buffer),this.currentIndex=0,this.isLittleEndian=t.littleEndian()}return r(t,[{key:"init",value:function(){this.currentIndex=0}},{key:"getData",value:function(t,e,i){t*=this.singleDataByteLength,null==e&&(e=4),null==i&&(i=0),t+=i;var r=this.isLittleEndian;switch(e){case 8:return this.dv.getFloat64(t,r);case 1:return this.dv.getUint8(t);case 5:return this.dv.getInt8(t);case 2:return this.dv.getUint8(t);case 6:return this.dv.getInt16(t,r);case 3:return this.dv.getUint16(t,r);case 4:return this.dv.getFloat32(t,r);case 7:return this.dv.getInt32(t,r);case 0:return this.dv.getUint32(t,r)}}},{key:"setData",value:function(t,e,i,r){var n=this.isLittleEndian;switch(null==r&&(r=0),null==i&&(i=4),e*=this.singleDataByteLength,e+=r,i){case 8:this.dv.setFloat64(e,t,n);break;case 1:this.dv.setUint8(e,t);break;case 5:this.dv.setInt8(e,t);break;case 2:this.dv.setUint8(e,t);break;case 6:this.dv.setInt16(e,t,n);break;case 3:this.dv.setUint16(e,t,n);break;case 4:this.dv.setFloat32(e,t,n);break;case 7:this.dv.setInt32(e,t,n);break;case 0:this.dv.setUint32(e,t,n)}}},{key:"resize",value:function(t){if(t<this.totalByteLength)throw Error("new length should not less than old length");var e=this.buffer;this.buffer=new ArrayBuffer(t);var i=new Uint8Array(e);new Uint8Array(this.buffer).set(i,0),this.dv=new DataView(this.buffer)}},{key:"totalByteLength",get:function(){return this.buffer.byteLength}}],[{key:"littleEndian",value:function(){if(null==n){var t=new ArrayBuffer(2),e=new Uint8Array(t),i=new Uint16Array(t);return e[0]=170,e[1]=187,48042===i[0]&&(n=!0),43707===i[0]&&(n=!1),n}return n}},{key:"TYPE_FLOAT32",get:function(){return 4}},{key:"TYPE_FLOAT64",get:function(){return 8}},{key:"TYPE_UINT8",get:function(){return 2}},{key:"TYPE_UINT16",get:function(){return 3}},{key:"TYPE_UINT32",get:function(){return 0}},{key:"TYPE_INT8",get:function(){return 5}},{key:"TYPE_INT16",get:function(){return 6}},{key:"TYPE_INT32",get:function(){return 7}},{key:"TYPE_UINT8CLAMPED",get:function(){return 1}}]),t}();e.default=a},function(t,e,i){t.exports=i(11)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=h(i(12)),n=h(i(4)),a=h(i(2)),s=h(i(6)),l=h(i(1)),u=h(i(3)),o=h(i(7));function h(t){return t&&t.__esModule?t:{default:t}}var f={version:"1.0.1",WebGL2D:r.default,Vector2:n.default,Vector3:a.default,Mat3:s.default,Mat4:l.default,GeometryTools:u.default,TextureManager:o.default},c={},d=function(t){var e=f[t];Object.defineProperty(c,t,{get:function(){return e}})};for(var y in f)d(y);e.default=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=k(i(13)),a=k(i(14)),s=k(i(15)),l=k(i(16)),u=k(i(17)),o=k(i(19)),h=k(i(22)),f=k(i(0)),c=k(i(1)),d=k(i(24)),y=k(i(25)),g=k(i(26)),v=k(i(2)),p=k(i(3)),x=k(i(4)),m=k(i(27)),b=k(i(29)),M=k(i(5)),w=k(i(8));function k(t){return t&&t.__esModule?t:{default:t}}var P=Symbol("对应的Canvas"),S=Symbol("状态栈"),T=Symbol("路径列表"),_=Symbol("绘制动作List"),I=Symbol("子Path缓存"),A=" ".charCodeAt(0),D=new Float32Array(4),C=new Float32Array(4),E=[255,255,255],R=[new Float32Array(4),new Float32Array(4),new Float32Array(4),new Float32Array(4)],V=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),null!=i&&null!=i||(i=[]);for(var r=0;r<R.length;r++)R[r][3]=1;if(D[2]=1,D[3]=1,C[3]=1,this[P]=e,null==e||null==e)throw new Error("canvas can not be undefined or null");if(this.gl=e.getContext("webgl"),null==this.gl)throw new Error("Current canvas doesnt support WebGL");var n=i.FOV||20,a=Math.tan(n*Math.PI/180);this.defaultDepth=-e.height/(2*a),this.maxBufferByteLength=i.maxMemorySize||1048576,this[S]=[],this[T]=[],this[_]=[],this[I]=[],this.webglRender=new h.default(this.gl,i.maxTransformNum,i.maxTextureSize,i.projectionType,n,i.enableLight,i.enableDepthTest);var s=this.maxBufferByteLength/32;this.verticesData=new d.default(s),this.indexData=new b.default(s),this.fragmentData=new y.default(s),this.transformMatrixData=new g.default(s),this.webglRender.verticesData=this.verticesData,this.webglRender.fragmentData=this.fragmentData,this.webglRender.transformMatrixData=this.transformMatrixData,this.webglRender.indexData=this.indexData,this.currentFaceNormal=new Float32Array(4),this.currentFaceNormal[2]=1,this._tempPathArray=null,this._tempActionList=null,this._tempGraphics=null,this._painedGraphicsMap={},this.fontManager=new m.default,this.tempVDOArrays={verticesData:null,fragmentData:null,indexData:null,transformMatrixData:null},this.currentVDOArrays={verticesData:this.verticesData,fragmentData:this.fragmentData,indexData:this.indexData,transformMatrixData:this.transformMatrixData}}return r(t,[{key:"clean",value:function(){this[T].length=0,this.webglRender.clean()}},{key:"clearRect",value:function(t,e,i,r){this.clean()}},{key:"beginPath",value:function(){this.currentPath.clean()}},{key:"closePath",value:function(){var t=this.currentPath;if(0!=t.subPathNumber){var e=t.lastSubPath;e.close();var i=e.getPointX(0),r=e.getPointX(0),n=e.getPointX(0),a=e.getPointStateId(0),s=new l.default;s.addPoint(i,r,n,a),t.addSubPath(s)}}},{key:"lineTo",value:function(t,e,i){null==i&&(i=0);var r=this.currentPath;if(null==r.lastSubPath){var n=new l.default;return r.addSubPath(n),void this.addPointInLastSubPath(t,e,i,!0)}this.addPointInLastSubPath(t,e,i,!0)}},{key:"addPointInPath",value:function(t,e,i,r,n){var a=this.currentContextState,s=a.transformMatrix;if(n&&!c.default.isIdentity(s)){var l=R[0];l[0]=t,l[1]=e,l[2]=i,l[3]=1,c.default.multiplyWithVertex(s,l,l),t=l[0],e=l[1],i=l[2]}r.addPoint(t,e,i,a.id)}},{key:"addPointInLastSubPath",value:function(t,e,i,r){this.addPointInPath(t,e,i,this.currentPath.lastSubPath,r)}},{key:"moveTo",value:function(t,e,i){null==i&&(i=0);var r=this.currentContextState,n=this.currentPath,a=n.lastSubPath;if(null!=a&&a.pointsNumber<2){var s=r.transformMatrix,u=R[0];u[0]=t,u[1]=e,u[2]=i,u[3]=1;var o=c.default.multiplyWithVertex(s,u,u);0!=a.pointsNumber?a.setPoint(0,o[0],o[1],o[2],r.id):a.addPoint(o[0],o[1],o[2],r.id)}else{var h=new l.default;n.addSubPath(h),this.addPointInLastSubPath(t,e,i,!0)}}},{key:"rect",value:function(t,e,i,r,n){null==n&&(n=0),this.moveTo(t,e,n),this.lineTo(t+i,e,n),this.lineTo(t+i,e+r,n),this.lineTo(t,e+r,n),this.closePath()}},{key:"bezierCurveTo",value:function(t,e,i,r,n,a){var s,l=t,u=e,o=this.currentPath,h=(this.currentContextState,o.lastSubPath),f=R[0];f[0]=t,f[1]=e,f[2]=0,f[3]=1;var d=this.currentContextState.transformMatrix;c.default.multiplyWithVertex(d,f,f),t=f[0],e=f[1],s=f[2],f[0]=i,f[1]=r,f[2]=0,f[3]=1,c.default.multiplyWithVertex(d,f,f),i=f[0],r=f[1],f[0]=n,f[1]=a,f[2]=0,f[3]=1,c.default.multiplyWithVertex(d,f,f),n=f[0],a=f[1];var y=t,g=e;if(null==h)this.moveTo(l,u);else{var v=h.pointsNumber-1,x=h.getPointX(v),m=h.getPointY(v);x!=t&&m!=e&&(y=x,g=m)}var b=6*(n-3*i+3*t-y),M=6*(a-3*r+3*e-g),w=1/(b*b+M*M);Math.pow(w,1/6);for(var k=R[0],P=.01;P<=1;P+=.01)p.default.cubicBezier(P,y,g,t,e,i,r,n,a,k),this.addPointInLastSubPath(k[0],k[1],s,!1);this.addPointInLastSubPath(n,a,s,!1)}},{key:"quadraticCurveTo",value:function(t,e,i,r){var n=this.currentPath,a=(this.currentContextState,n.lastSubPath),s=R[0];s[0]=t,s[1]=e,s[2]=0,s[3]=1;var u=this.currentContextState.transformMatrix;c.default.multiplyWithVertex(u,s,s),t=s[0],e=s[1];var o=s[2];s[0]=i,s[1]=r,s[2]=0,s[3]=1,c.default.multiplyWithVertex(u,s,s),i=s[0],r=s[1];var h=s[2],f=t,d=e;if(null==a){var y=new l.default;n.addSubPath(y),this.addPointInLastSubPath(t,e,o,!1)}else{var g=a.pointsNumber-1,v=a.getPointX(g),x=a.getPointY(g);v!=t&&x!=e&&(f=v,d=x)}if(f!=t||d!=e){for(var m=2*(i-2*t+f),b=2*(r-2*e+d),M=1/(m*m+b*b),w=Math.pow(M,.25),k=R[0],P=w;P<=1;P+=w)p.default.quadraticBezier(P,f,d,t,e,i,r,k),this.addPointInLastSubPath(k[0],k[1],o,!1);this.addPointInLastSubPath(i,r,h,!1)}else this.addPointInLastSubPath(i,r,h,!1)}},{key:"arcTo",value:function(t,e,i,r,n){if(n<0)throw new Error("IndexError: Radius value wrong");var a=this.currentPath.lastSubPath,s=0,u=0;if(null==a)return a=new l.default,this.currentPath.addSubPath(a),void this.moveTo(t,e);var o=a.getPointX(a.pointsNumber-1),h=a.getPointY(a.pointsNumber-1),d=a.getPointZ(a.pointsNumber-1),y=R[0];y[0]=o,y[1]=h,y[2]=d,y[3]=1;var g=this.currentContextState.transformMatrix,v=c.default.TEMP_MAT4[0];if(c.default.copy(g,v),c.default.inverse(v,v),c.default.multiplyWithVertex(v,y,y),f.default.equals(o,t)&&f.default.equals(h,e)||f.default.equals(t,i)&&f.default.equals(e,r)||0==n)this.lineTo(t,e);else{s=y[0],u=y[1];var m=new x.default(s-t,u-e),b=new x.default(i-t,r-e);x.default.normalize(m,m),x.default.normalize(b,b);var M=new x.default;x.default.plus(M,m,b),x.default.normalize(M,M);var w=Math.acos(x.default.dot(m,M));if(f.default.equals(2*w%Math.PI,0))this.lineTo(t,e);else{var k=n/Math.sin(w),P=M.x*k+t,S=M.y*k+e,T={x:P,y:S},_={x:t,y:e},I={x:s,y:u},A={x:i,y:r},D=p.default.getProjectionPointOnLine(T,_,I),C=p.default.getProjectionPointOnLine(T,_,A),E=new x.default(D.x-P,D.y-S),V=new x.default(C.x-P,C.y-S);x.default.normalize(E,E),x.default.normalize(V,V);var O=Math.atan2(E.y,E.x),N=O;N=z(N);var L=Math.atan2(V.y,V.x),F=L;F=z(F);var B=!1;Math.abs(N-F)>Math.PI&&(B=!0),this.arc(P,S,n,O,L,B)}}function z(t){var e=2*Math.PI,i=Math.floor(Math.abs(t/e));return t<0&&(t+=i*e),t>=e&&(t-=i*e),t}}},{key:"ellipse",value:function(t,e,i,r,n,a,s,u){if(i<0||r<0)throw new Error("IndexError.半径必须不小于0. Radius should not be smaller than zero. BanJing BiXu BuXiaoYu Ling");if(0!=i&&0!=r){null==u&&(u=!1);var o=this.currentPath.lastSubPath;null==o&&(o=new l.default,this.currentPath.addSubPath(o));var h=c.default.TEMP_MAT4[0];c.default.translationMatrix(h,t,e,0);var d=this.currentContextState.transformMatrix;c.default.multiply(h,d,h);var y=c.default.TEMP_MAT4[1];c.default.rotationZMatrix(y,n),c.default.multiply(h,h,y),c.default.identityMatrix(y),y[0]=i,y[5]=r,c.default.multiply(h,h,y);var g=R[0];g[0]=0,g[1]=0,g[2]=0,g[3]=1,c.default.multiplyWithVertex(d,g,g);var p=g[0],x=g[1];g[0]=1,g[1]=0,g[2]=0,g[3]=1,c.default.multiplyWithVertex(d,g,g);var m=g[0],b=g[1],M=(m-p)*(m-p)+(b-x)*(b-x);M=Math.sqrt(M);var w=Math.max(i*M,r*M),k=2*Math.asin(1/w),P=new v.default;if(((a=V(a))>(s=V(s))&&!u||a<s&&u)&&((a<0||s<0)&&((s-=2*Math.PI)==a||Math.abs(s-a)<=f.default.EPSILON)&&(s-=2*Math.PI),(a>0||s>0)&&((s+=2*Math.PI)==a||Math.abs(s-a)<=f.default.EPSILON)&&(s+=2*Math.PI)),u)for(var S=a;S>s;S-=k){if(Math.abs(S-a)>=f.default.PI2)return;var T=Math.sin(S),_=Math.cos(S);P.x=_,P.y=T,P.z=0,c.default.multiplyWithVertex(h,P.value,P.value),this.addPointInLastSubPath(P.x,P.y,P.z,!1)}else for(var I=a;I<s;I+=k){if(Math.abs(I-a)>=f.default.PI2)return;var A=Math.sin(I),D=Math.cos(I);P.x=D,P.y=A,P.z=0,c.default.multiplyWithVertex(h,P.value,P.value),this.addPointInLastSubPath(P.x,P.y,P.z,!1)}var C=Math.sin(s),E=Math.cos(s);P.x=E,P.y=C,P.z=0,c.default.multiplyWithVertex(h,P.value,P.value),this.addPointInLastSubPath(P.x,P.y,P.z,!1)}function V(t){var e=2*Math.PI,i=Math.floor(Math.abs(t/e))+1;return t<0&&!u&&(t+=i*e),t>0&&u&&(t-=i*e),t}}},{key:"arc",value:function(t,e,i,r,n,a){this.ellipse(t,e,i,i,0,r,n,a)}},{key:"save",value:function(){var t=this.currentContextState.clone();this[S].push(t)}},{key:"restore",value:function(){0!=this[S].length&&this[S].pop()}},{key:"translate",value:function(t,e,i){this.currentContextState.translate(t,e,i)}},{key:"rotate",value:function(t){this.currentContextState.rotateZ(t)}},{key:"rotateX",value:function(t){this.currentContextState.rotateX(t)}},{key:"rotateY",value:function(t){this.currentContextState.rotateY(t)}},{key:"scale",value:function(t,e,i){this.currentContextState.scale(t,e,i)}},{key:"setTransform",value:function(t,e,i,r,n,a){c.default.identityMatrix(this.currentContextState.transformMatrix);var s=this.currentContextState.transformMatrix;s[0]=t,s[1]=e,s[4]=i,s[5]=r,s[12]=n,s[13]=a,s[14]=0}},{key:"transform",value:function(t,e,i,r,n,a){var s=c.default.TEMP_MAT4[0];c.default.identityMatrix(s),s[0]=t,s[1]=e,s[4]=i,s[5]=r,s[12]=n,s[13]=a,this.currentContextState.applyTransform(s)}},{key:"applyTransformMatrix",value:function(t){this.currentContextState.applyTransform(t)}},{key:"drawImage",value:function(t,e,i,r,n,a,s,l,u,h,f){h=h||0;var c=void 0;c=t instanceof w.default?t:this.webglRender.textureManager.getTexture(t,this.gl,!0);var d=new o.default(o.default.ACTION_FILL);d.textureIndex=c.index;var y=void 0,g=void 0,v=void 0,p=void 0,x=void 0,m=void 0,b=void 0,M=void 0;3==arguments.length&&(y=e,g=i,v=e+t.width,p=i+t.height,x=c.x,b=c.x+c.width,m=c.y,M=c.y+c.height),4==arguments.length&&(y=e,g=i,v=e+t.width,p=i+t.height,x=c.x,b=c.x+c.width,m=c.y,M=c.y+c.height,h=r),5==arguments.length&&(y=e,g=i,v=e+r,p=i+n,x=c.x,b=c.x+c.width,m=c.y,M=c.y+c.height),6==arguments.length&&(y=e,g=i,v=e+r,p=i+n,x=c.x,b=c.x+c.width,m=c.y,M=c.y+c.height,h=a),9!=arguments.length&&10!=arguments.length&&11!=arguments.length||(y=a,g=s,v=a+l,p=s+u,x=c.x+e,b=c.x+e+r,m=c.y+i,M=c.y+i+n),this.beginPath(),this.rect(y,g,v-y,p-g,h),this.currentPath.subPathArray[this.currentPath.subPathNumber-2].isRegularRect=!0;var k=this.currentContextState.globalAlpha,P=this[T];this[_].push(d);var S=new Array(4);S[0]=[x,m],S[1]=[b,m],S[2]=[b,M],S[3]=[x,M],f=f||E;var I=this.getVDOArrays();d.verticesData=I.verticesData,d.fragmentData=I.fragmentData,d.indexData=I.indexData,d.collectVertexDataForFill(P,f,k,S,this.currentContextState.filterType,this.currentFaceVector)}},{key:"fill",value:function(){var t=u.default.getInstance().convertStringToColor(this.currentContextState.fillStyle),e=this.currentContextState.globalAlpha,i=this[T],r=new o.default(o.default.ACTION_FILL),n=this.getVDOArrays();r.verticesData=n.verticesData,r.fragmentData=n.fragmentData,r.indexData=n.indexData,this[_].push(r),r.collectVertexDataForFill(i,t,e*t[3],[0,0],this.currentContextState.filterType,this.currentFaceVector)}},{key:"measureText",value:function(t,e){if(null==e){var i=this.fontFamily;if(i=i.trim().toLocaleLowerCase(),null==(e=this.fontManager.getBMFont(i)))throw new Error("TieLiFa can not find the font:"+i+",you can register the BM Font with API")}for(var r=t,n=0,a=this.fontSize/e.size,s=e.chars[" ".charCodeAt(0)],l=0;l<r.length;l++){var u=r.charCodeAt(l),o=e.chars[u];n+=null!=o?o.xadvance:s.xadvance}return{width:n*a}}},{key:"fillText",value:function(t,e,i,r){var n=this.fontFamily;n=n.trim().toLocaleLowerCase();var a=this.fontManager.getBMFont(n);if(null==a)throw new Error("TieLiFa can not find the font:"+n+",you can register the BM Font with API");var s=t,l=this.fontSize,o=l/a.size;a.common.base,this.save(),this.translate(e,i),this.scale(o,o),this.translate(-e,-i);var h=u.default.getInstance().convertStringToColor(this.currentContextState.fillStyle),f=this.textBaseline,c=this.textAlign,d=this.measureText(t,a),y=1,g=d.width;if(null!=r&&r<d.width){if(0==r)return;y=r/d.width,g=r}"end"!=c&&"right"!=c||(e-=g/o),"center"==c&&(e-=g/o/2),"bottom"==f&&(i-=l/o),"middle"==f&&(i-=l/2/o);for(var v=a.chars[A],p=0;p<s.length;p++){var x=s.charCodeAt(p),m=a.chars[x];if(null!=m){var b=m.height,M=m.width;M*=y;var w=this.fontManager.getFontImage(n,m.page);null!=w&&null!=w&&(x!=A&&this.drawImage(w,m.x,m.y,m.width,m.height,e+m.xoffset*y,i+m.yoffset,M,b,0,h),e+=m.xadvance*y)}else e+=v.xadvance*y}this.restore()}},{key:"fillRect",value:function(t,e,i,r,n){n=n||0,this.beginPath(),this.rect(t,e,i,r,n),this.currentPath.subPathArray[this.currentPath.subPathNumber-2].isRegularRect=!0,this.fill()}},{key:"strokeRect",value:function(t,e,i,r,n){n=n||0,this.beginPath(),this.rect(t,e,i,r,n),this.stroke()}},{key:"stroke",value:function(){var t=u.default.getInstance().convertStringToColor(this.currentContextState.strokeStyle),e=this.currentContextState.globalAlpha,i=this[T],r=this.currentContextState.lineWidth,n=this.currentContextState.filterType,a=new o.default(o.default.ACTION_FILL),s=this.getVDOArrays();a.verticesData=s.verticesData,a.fragmentData=s.fragmentData,a.indexData=s.indexData,this[_].push(a),a.collectVertexDataForStroke(i,t,e*t[3],[0,0],r,n,this.currentFaceVector)}},{key:"createImageData",value:function(t,e){if(1==arguments.length){var i=t;t=i.width,e=i.height}var r=new Uint8ClampedArray(t*e*4);return new ImageData(r,t,e)}},{key:"applyCurrentTransform",value:function(t){var e=this.currentContextState.transformMatrix,i=R[0];return i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=1,c.default.multiplyWithVertex(e,i,i),{x:i[0],y:i[1],z:i[2]}}},{key:"drawGraphics",value:function(t,e,i){if(null==this._tempGraphics){for(var r=0;r<t.actionList.length;r++){var n=t.actionList[r],a=new o.default(n.type);if(a.textureIndex=n.textureIndex,a.renderPointNumber=n.renderPointNumber,null!=e&&null!=i){if(0!=e||0!=i){var s=c.default.translation(e,i,0);c.default.multiply(s,this.currentContextState.transformMatrix,s),a=s}}else a.applyMatrix=this.currentContextState.transformMatrix;this[_].push(a)}var l=this.getVDOArrays(),u=l.verticesData.currentIndex,h=this._painedGraphicsMap[t];if(null==h){l.verticesData.append(t.verticesData),l.fragmentData.append(t.fragmentData),h={start:l.indexData.currentIndex,length:t.indexData.currentIndex};for(var f=0;f<t.indexData.currentIndex;f++)l.indexData.addIndex(t.indexData.getIndex(f)+u);this._painedGraphicsMap[t]=h}else for(var d=0;d<h.length;d++){var y=l.indexData.getIndex(d+h.start);l.indexData.addIndex(y)}}}},{key:"getVDOArrays",value:function(){return this.currentVDOArrays}},{key:"setVDOArrays",value:function(t,e,i,r){this.currentVDOArrays.verticesData=t,this.currentVDOArrays.fragmentData=e,this.currentVDOArrays.transformMatrixData=i,this.currentVDOArrays.indexData=r}},{key:"startGraphics",value:function(t,e){if(null==this._tempGraphics){e=e||4,this._tempPathArray=this[T],this[T]=[],this[T].push(new s.default);var i=new n.default(new a.default);this[S].push(i),null!=t?(t.verticesData.init(),t.fragmentData.init(),t.indexData.init(),t.actionList.length=0):t={verticesData:new d.default(e),fragmentData:new y.default(e),indexData:new b.default(e),transformMatrixData:null,actionList:[]},this.tempVDOArrays.verticesData=t.verticesData,this.tempVDOArrays.fragmentData=t.fragmentData,this.tempVDOArrays.indexData=t.indexData,this._tempGraphics=t,this._tempActionList=this[_],this[_]=t.actionList,this.setVDOArrays(this.tempVDOArrays.verticesData,this.tempVDOArrays.fragmentData,null,this.tempVDOArrays.indexData)}}},{key:"endGraphics",value:function(){this[S].pop(),this[T]=this._tempPathArray,this[_]=this._tempActionList,this.currentVDOArrays.verticesData=this.verticesData,this.currentVDOArrays.fragmentData=this.fragmentData,this.currentVDOArrays.transformMatrixData=this.transformMatrixData,this.currentVDOArrays.indexData=this.indexData,this._tempPathArray=null,this._tempActionList=null,this.tempVDOArrays.verticesData=null,this.tempVDOArrays.fragmentData=null,this.tempVDOArrays.indexData=null,this.tempVDOArrays.transformMatrixData=null;var t=this._tempGraphics;return this._tempGraphics=null,t}},{key:"loadBMFont",value:function(t,e){e=e||{},this.fontManager.loadBMFont(t,this.webglRender.textureManager,this.gl,e)}},{key:"turnOnLight",value:function(){this.webglRender.enableLight(!0)}},{key:"turnOffLight",value:function(){this.webglRender.enableLight(!1)}},{key:"setLightPosition",value:function(t,e,i){this.webglRender.setLightPosition(t,e,i)}},{key:"fillOrStroke",value:function(t,e){null!=t&&(this.fillStyle=t,this.fill()),null!=e&&(this.strokeStyle=e,this.stroke())}},{key:"fillStripe",value:function(t,e,i,r,n,a){if(null==a&&(a=!0),a){for(var s=[],l=0;l<t.length;l++){var u=this.applyCurrentTransform(t[l]);s.push(u)}t=s}var o={getX:function(e){return t[e].x},getY:function(e){return t[e].y},getZ:function(e){var i=t[e].z;return null==i?0:i},getPointsNum:function(){return t.length}};this._rawFillLine(o,e,i,r,void 0,n)}},{key:"_rawFillLine",value:function(t,e,i,r,n,a){var s=t.getPointsNum();if(!(s<2)){var l=this.getVDOArrays(),h=this.currentFaceVector;r=r||this.currentContextState.globalAlpha,n=n||this.currentContextState.filterType,i=i||this.currentContextState.fillStyle;var f=u.default.getInstance().convertStringToColor(i),c=l.verticesData.currentIndex,d=null;a&&(d=this.webglRender.textureManager.getTexture(a,this.gl,!0));var y=0,g=0;null!=d&&(y=d.width/(s-1),g=d.height);for(var v={setPoint:function(t,e){l.verticesData.setVerticesCoor(t.x,t.y,t.z,e+c)},addPoint:function(t,e,i){if(null!=l.verticesData&&l.verticesData.addVerticesData(t.x,t.y,t.z,h[0],h[1],h[2]),null!=l.fragmentData){var a=[0,0];null!=d&&(0==e?(0==i&&(a[0]=e*y,a[1]=0),3==i&&(a[0]=e*y,a[1]=g)):(0==i&&(a[0]=(e-1)*y+y,a[1]=0),3==i&&(a[0]=(e-1)*y+y,a[1]=g)),1==i&&(a[0]=e*y+y,a[1]=0),2==i&&(a[0]=e*y+y,a[1]=g)),l.fragmentData.addFragmentData(f[0],f[1],f[2],r,a[0],a[1],-1,n)}}},p=M.default.generateRectanglesPoints(e,!1,h,v,t),x=0;x<p;x++){var m=4*x;l.indexData.addIndex(c+m),l.indexData.addIndex(c+m+1),l.indexData.addIndex(c+m+2),l.indexData.addIndex(c+m+2),l.indexData.addIndex(c+m+3),l.indexData.addIndex(c+m)}var b=new o.default(o.default.ACTION_FILL);b.textureIndex=-1,null!=d&&(b.textureIndex=d.index),b.renderPointNumber=6*p,this[_].push(b)}}},{key:"drawRectangle",value:function(t,e,i,r,n,a){this.save(),this.beginPath(),this.rect(t,e,i,r),this.currentPath.subPathArray[this.currentPath.subPathNumber-2].isRegularRect=!0,this.fillOrStroke(n,a),this.restore()}},{key:"drawEllipse",value:function(t,e,i,r,n,a,s){s=s||0,this.save(),this.beginPath(),this.ellipse(t,e,i,r,s,0,f.default.PI2,!1),this.closePath(),this.fillOrStroke(n,a),this.restore()}},{key:"drawCircle",value:function(t,e,i,r,n){this.drawEllipse(t,e,i,i,r,n,0)}},{key:"draw",value:function(){null==this._tempGraphics&&(this.webglRender.initRending(),this.webglRender.executeRenderAction(this[_]),this[_]=[],this.verticesData.init(),this.fragmentData.init(),this.transformMatrixData.init(),this.indexData.init(),this._painedGraphicsMap={})}},{key:"loadImage",value:function(t,e,i,r){this.webglRender.textureManager.registerTexture(t,this.gl,null,e,i,r)}},{key:"getTexture",value:function(t,e){return this.webglRender.textureManager.getTextureById(t,e)}},{key:"clearImageCatches",value:function(){this.webglRender.textureManager.cleanImageData()}},{key:"currentContextState",get:function(){if(0==this[S].length){var t=new n.default(new a.default);this[S].push(t)}return this[S][this[S].length-1]}},{key:"currentPath",get:function(){return 0==this[T].length&&this[T].push(new s.default),this[T][this[T].length-1]}},{key:"canvas",get:function(){return this[P]}},{key:"strokeStyle",set:function(t){this.currentContextState.strokeStyle=t},get:function(){return this.currentContextState.strokeStyle}},{key:"currentFaceVector",get:function(){var t=this.currentContextState.transformMatrix,e=v.default.TEMP_VECTORS[0],i=v.default.TEMP_VECTORS[1];return e.x=D[0],e.y=D[1],e.z=D[2],e.value[3]=1,i.x=C[0],i.y=C[1],i.z=C[2],i.value[3]=1,c.default.isIdentity(t)||(c.default.multiplyWithVertex(t,D,e.value),c.default.multiplyWithVertex(t,C,i.value)),this.currentFaceNormal[0]=e.x-i.x,this.currentFaceNormal[1]=e.y-i.y,this.currentFaceNormal[2]=e.z-i.z,this.currentFaceNormal}},{key:"fontFamily",get:function(){return this.currentContextState.canvasDrawingStyle.fontFamily},set:function(t){this.currentContextState.canvasDrawingStyle.fontFamily=t}},{key:"fontSize",get:function(){return this.currentContextState.canvasDrawingStyle.fontSize},set:function(t){this.currentContextState.canvasDrawingStyle.fontSize=t}},{key:"fillStyle",set:function(t){this.currentContextState.fillStyle=t},get:function(){return this.currentContextState.fillStyle}},{key:"globalAlpha",set:function(t){this.currentContextState.globalAlpha=t},get:function(){return this.currentContextState.globalAlpha}},{key:"lineWidth",set:function(t){this.currentContextState.lineWidth=t},get:function(){return this.currentContextState.lineWidth}},{key:"textAlign",get:function(){return this.currentContextState.textAlign},set:function(t){this.currentContextState.textAlign=t}},{key:"textBaseline",get:function(){return this.currentContextState.textBaseline},set:function(t){this.currentContextState.textBaseline=t}},{key:"filterType",get:function(){return this.currentContextState.filterType},set:function(t){this.currentContextState.filterType=t}}],[{key:"Normal_Filter",get:function(){return n.default.Normal_Filter}},{key:"GaussianBlur_Filter",get:function(){return n.default.GaussianBlur_Filter}},{key:"Unsharpen_Filter",get:function(){return n.default.Unsharpen_Filter}},{key:"Sharpness_Filter",get:function(){return n.default.Sharpen_Filter}},{key:"Sharpen_Filter",get:function(){return n.default.Sharpen_Filter}},{key:"EdgeDetect_Filter",get:function(){return n.default.EdgeDetect_Filter}},{key:"SobelHorizontal_Filter",get:function(){return n.default.SobelHorizontal_Filter}},{key:"SobelVertical_Filter",get:function(){return n.default.SobelVertical_Filter}},{key:"PrevitHorizontal_Filter",get:function(){return n.default.PrevitHorizontal_Filter}},{key:"PrevitVertical_Filter",get:function(){return n.default.PrevitVertical_Filter}},{key:"BoxBlur_Filter",get:function(){return n.default.BoxBlur_Filter}},{key:"TriangleBlur_Filter",get:function(){return n.default.TriangleBlur_Filter}},{key:"Emboss_Filter",get:function(){return n.default.Emboss_Filter}}]),t}();e.default=V},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=s(i(1)),a=s(i(0));function s(t){return t&&t.__esModule?t:{default:t}}var l=0,u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvasDrawingStyle=e,this.matrixIndex=0,this.fillStyle="#000000",this.strokeStyle="#000000",this.globalAlpha=1,this.id=-1,this.matrix=n.default.identity(),this.filterType=l,this.dirty=!1}return r(t,[{key:"setTransformMatrix",value:function(t){n.default.copy(t,this.matrix)}},{key:"applyTransform",value:function(t){var e=this.matrix;n.default.multiply(e,e,t)}},{key:"translate",value:function(t,e,i){if(void 0===i&&(i=0),!(a.default.equals(t,0)&&a.default.equals(e,0)&&a.default.equals(i,0))){var r=n.default.TEMP_MAT4[0];n.default.translationMatrix(r,t,e,i),this.applyTransform(r)}}},{key:"rotateZ",value:function(t){if(!a.default.equals(t,0)){var e=n.default.TEMP_MAT4[0];n.default.rotationZMatrix(e,t),this.applyTransform(e)}}},{key:"rotateX",value:function(t){if(!a.default.equals(t,0)){var e=n.default.TEMP_MAT4[0];n.default.rotationXMatrix(e,t),this.applyTransform(e)}}},{key:"rotateY",value:function(t){if(!a.default.equals(t,0)){var e=n.default.TEMP_MAT4[0];n.default.rotationYMatrix(e,t),this.applyTransform(e)}}},{key:"scale",value:function(t,e,i){if(void 0===i&&(i=1),!(a.default.equals(t,1)&&a.default.equals(e,1)&&a.default.equals(i,1))){var r=n.default.TEMP_MAT4[0];n.default.scalingMatrix(r,t,e,i),this.applyTransform(r)}}},{key:"clone",value:function(){var e=new t(this.canvasDrawingStyle.clone());return e.fillStyle=this.fillStyle,e.strokeStyle=this.strokeStyle,e.globalAlpha=this.globalAlpha,e.filterType=this.filterType,e.setTransformMatrix(this.transformMatrix),e}},{key:"transformMatrixId",get:function(){return t.matrixList.length-1}},{key:"transformMatrix",get:function(){return this.matrix}},{key:"lineWidth",get:function(){return this.canvasDrawingStyle.lineWidth},set:function(t){this.canvasDrawingStyle.lineWidth=t}},{key:"textAlign",get:function(){return this.canvasDrawingStyle.textAlign},set:function(t){this.canvasDrawingStyle.textAlign=t}},{key:"textBaseline",get:function(){return this.canvasDrawingStyle.textBaseline},set:function(t){this.canvasDrawingStyle.textBaseline=t}}],[{key:"Normal_Filter",get:function(){return l}},{key:"GaussianBlur_Filter",get:function(){return 1}},{key:"Unsharpen_Filter",get:function(){return 2}},{key:"Sharpness_Filter",get:function(){return 4}},{key:"Sharpen_Filter",get:function(){return 4}},{key:"EdgeDetect_Filter",get:function(){return 5}},{key:"SobelHorizontal_Filter",get:function(){return 6}},{key:"SobelVertical_Filter",get:function(){return 7}},{key:"PrevitHorizontal_Filter",get:function(){return 8}},{key:"PrevitVertical_Filter",get:function(){return 9}},{key:"BoxBlur_Filter",get:function(){return 10}},{key:"TriangleBlur_Filter",get:function(){return 11}},{key:"Emboss_Filter",get:function(){return 12}}]),t}();e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=Symbol("线宽度,默认1"),a=Symbol('线连接样式，"butt", "round", "square" (默认: "butt")'),s=Symbol('线连接样式，"round", "bevel", "miter" (默认: "miter")'),l=Symbol("默认10"),u=Symbol('文字字体大小等，默认"10px sans-serif"'),o=Symbol('文字对齐,"start", "end", "left", "right", "center" (默认: "start")'),h=Symbol('文字纵向对齐，"top", "hanging", "middle", "alphabetic", "ideographic", "bottom" (默认: "alphabetic")'),f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[n]=1,this[a]="butt",this[s]="miter",this[l]=10,this.font="10px sans-serif",this.textAlign="start",this.textBaseline="alphabetic",this.fontFamily="Arial",this.fontSize=32}return r(t,[{key:"clone",value:function(){var e=new t;return e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,e.font=this.font,e.lineCap=this.lineCap,e.lineJoin=this.lineJoin,e.lineWidth=this.lineWidth,e.fontFamily=this.fontFamily,e.fontSize=this.fontSize,e}},{key:"lineCap",get:function(){return this[a]},set:function(t){this[a]=t}},{key:"lineWidth",get:function(){return this[n]},set:function(t){this[n]=t}},{key:"lineJoin",get:function(){return this[s]},set:function(t){this[s]=t}},{key:"miterLimit",get:function(){return this[l]},set:function(t){this[l]=t}},{key:"font",get:function(){return this[u]},set:function(t){this[u]=t}},{key:"textAlign",get:function(){return this[o]},set:function(t){this[o]=t}},{key:"textBaseline",get:function(){return this[h]},set:function(t){this[h]=t}}]),t}();e.default=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subPathArray=[]}return r(t,[{key:"addSubPath",value:function(t){this.subPathArray.push(t)}},{key:"clean",value:function(){this.subPathArray=[]}},{key:"subPathNumber",get:function(){return this.subPathArray.length}},{key:"lastSubPath",get:function(){if(0!=this.subPathNumber)return this.subPathArray[this.subPathNumber-1]}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=Symbol("当前的点所在的索引位置"),a=Symbol("点的坐标值数组,每三个为一组，分别是x,y,z"),s=Symbol("点的坐标值数组，每两个为一组，分别是stateId,matrixId"),l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[n]=0,this[a]=[],this[s]=[],this.isClosed=!1,this.isRegularRect=!1}return r(t,[{key:"init",value:function(){this.isClosed=!1,this[n]=0}},{key:"getPointX",value:function(t){return t*=3,this[a][t]}},{key:"getPointY",value:function(t){return t*=3,this[a][t+1]}},{key:"getPointZ",value:function(t){return t*=3,this[a][t+2]}},{key:"getPointStateId",value:function(t){return t*=2,this[s][t]}},{key:"getPointMatrixId",value:function(t){return t*=2,this[s][t+1]}},{key:"getPointMatrixData",value:function(t){return[this.getPointStateId(t),this.getPointMatrixId(t)]}},{key:"setPoint",value:function(t,e,i,r,n){n=n||0,t*=3,this[a][t]=e,this[a][t+1]=i,this[a][t+2]=r}},{key:"addPoint",value:function(t,e,i,r){r=r||0;var s=this[n];3*s>=this[a].length?(this[a].push(t),this[a].push(e),this[a].push(i)):(this[a][s]=t,this[a][s+1]=e,this[a][s+2]=i),this[n]++}},{key:"close",value:function(){this.isClosed=!0}},{key:"clean",value:function(){this[a]=[],this[s]=[],this.isClosed=!1}},{key:"pointsCoordinateArray",get:function(){return this[a]}},{key:"pointsNumber",get:function(){return this[n]}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),a=i(18),s=(r=a)&&r.__esModule?r:{default:r},l=void 0,u=function(){function t(){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l)return l;l=this,this.colorMap={}}return n(t,[{key:"convertStringToColor",value:function(e){var i=this.colorMap[e];return null!=i?i:(e=e.toLowerCase(),t.isRGBAString(e)?this.rgba2vec(e):t.isHSLAString(e)?this.hsla2vet3(e):this.getVec(e,e,1))}},{key:"hsla2vet3",value:function(t){var e=t,i=this.colorMap[e];if(null!=i)return i;var r=1;if(3==(t=(t=t.match(new RegExp(",","g")))||[]).length){var n=(t=e).lastIndexOf(","),a=t.lastIndexOf(")"),s=t.substring(n+1,a);r=parseFloat(s),t=t.substring(0,n),t+=")"}else t=e;t=t.replace("a","");var l=w3color(t);return l.valid?(i=[l.r,l.g,l.b,r],this.colorMap[e]=i,i):[0,0,0,1]}},{key:"rgba2vec",value:function(t){var e=t,i=this.colorMap[e];if(null!=i)return i;var r=1;if(3==(t=(t=t.match(new RegExp(",","g")))||[]).length){var n=(t=e).lastIndexOf(","),a=t.lastIndexOf(")"),s=t.substring(n+1,a);r=parseFloat(s),t=t.substring(0,n),t+=")"}else t=e;return t=t.replace("a",""),this.getVec(t,e,r)}},{key:"getVec",value:function(t,e,i){var r=this.colorMap[e];if(null!=r)return r;var n=new s.default(t);if(n.valid){var a=n.toRgb(),l=[a.r,a.g,a.b,i];return null==this.colorMap[e]&&(this.colorMap[e]=l),l}return[0,0,0,1]}}],[{key:"getInstance",value:function(){return l||(l=new t),l}},{key:"isRGBAString",value:function(t){return!(!t||0!=t.indexOf("rgba"))}},{key:"isHSLAString",value:function(t){return!(!t||0!=t.indexOf("hsla"))}}]),t}();e.default=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),s=function(){function t(e,i){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this instanceof t?"object"==(void 0===e?"undefined":n(e))?e:(this.attachValues(t.toColorObject(e)),void(i&&(i.style.backgroundColor=this.toRgbString()))):new t(e,i)}return a(t,[{key:"attachValues",value:function(t){this.red=t.red,this.green=t.green,this.blue=t.blue,this.hue=t.hue,this.sat=t.sat,this.lightness=t.lightness,this.whiteness=t.whiteness,this.blackness=t.blackness,this.cyan=t.cyan,this.magenta=t.magenta,this.yellow=t.yellow,this.black=t.black,this.ncol=t.ncol,this.opacity=t.opacity,this.valid=t.valid}},{key:"toRgbString",value:function(){return"rgb("+this.red+", "+this.green+", "+this.blue+")"}},{key:"toRgbaString",value:function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.opacity+")"}},{key:"toHwbString",value:function(){return"hwb("+this.hue+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%)"}},{key:"toHwbStringDecimal",value:function(){return"hwb("+this.hue+", "+this.whiteness+", "+this.blackness+")"}},{key:"toHwbaString",value:function(){return"hwba("+this.hue+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%, "+this.opacity+")"}},{key:"toHslString",value:function(){return"hsl("+this.hue+", "+Math.round(100*this.sat)+"%, "+Math.round(100*this.lightness)+"%)"}},{key:"toHslStringDecimal",value:function(){return"hsl("+this.hue+", "+this.sat+", "+this.lightness+")"}},{key:"toHslaString",value:function(){return"hsla("+this.hue+", "+Math.round(100*this.sat)+"%, "+Math.round(100*this.lightness)+"%, "+this.opacity+")"}},{key:"toCmykString",value:function(){return"cmyk("+Math.round(100*this.cyan)+"%, "+Math.round(100*this.magenta)+"%, "+Math.round(100*this.yellow)+"%, "+Math.round(100*this.black)+"%)"}},{key:"toCmykStringDecimal",value:function(){return"cmyk("+this.cyan+", "+this.magenta+", "+this.yellow+", "+this.black+")"}},{key:"toNcolString",value:function(){return this.ncol+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%"}},{key:"toNcolStringDecimal",value:function(){return this.ncol+", "+this.whiteness+", "+this.blackness}},{key:"toNcolaString",value:function(){return this.ncol+", "+Math.round(100*this.whiteness)+"%, "+Math.round(100*this.blackness)+"%, "+this.opacity}},{key:"toName",value:function(){var t,e,r,n=getColorArr("hexs");for(i=0;i<n.length;i++)if(t=parseInt(n[i].substr(0,2),16),e=parseInt(n[i].substr(2,2),16),r=parseInt(n[i].substr(4,2),16),this.red==t&&this.green==e&&this.blue==r)return getColorArr("names")[i];return""}},{key:"toHexString",value:function(){return"#"+toHex(this.red)+toHex(this.green)+toHex(this.blue)}},{key:"toRgb",value:function(){return{r:this.red,g:this.green,b:this.blue,a:this.opacity}}},{key:"toHsl",value:function(){return{h:this.hue,s:this.sat,l:this.lightness,a:this.opacity}}},{key:"toHwb",value:function(){return{h:this.hue,w:this.whiteness,b:this.blackness,a:this.opacity}}},{key:"toCmyk",value:function(){return{c:this.cyan,m:this.magenta,y:this.yellow,k:this.black,a:this.opacity}}},{key:"toNcol",value:function(){return{ncol:this.ncol,w:this.whiteness,b:this.blackness,a:this.opacity}}},{key:"isDark",value:function(t){var e=t||128;return(299*this.red+587*this.green+114*this.blue)/1e3<e}},{key:"saturate",value:function(t){var e,i,r;e=t/100||.1,this.sat+=e,this.sat>1&&(this.sat=1),i=hslToRgb(this.hue,this.sat,this.lightness),r=colorObject(i,this.opacity,this.hue,this.sat),this.attachValues(r)}},{key:"desaturate",value:function(t){var e,i,r;e=t/100||.1,this.sat-=e,this.sat<0&&(this.sat=0),i=hslToRgb(this.hue,this.sat,this.lightness),r=colorObject(i,this.opacity,this.hue,this.sat),this.attachValues(r)}},{key:"lighter",value:function(t){var e,i,r;e=t/100||.1,this.lightness+=e,this.lightness>1&&(this.lightness=1),i=hslToRgb(this.hue,this.sat,this.lightness),r=colorObject(i,this.opacity,this.hue,this.sat),this.attachValues(r)}},{key:"darker",value:function(t){var e,i,r;e=t/100||.1,this.lightness-=e,this.lightness<0&&(this.lightness=0),i=hslToRgb(this.hue,this.sat,this.lightness),r=colorObject(i,this.opacity,this.hue,this.sat),this.attachValues(r)}}],[{key:"w3color",value:function(t){function e(e,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){return this instanceof w3color?"object"==(void 0===t?"undefined":n(t))?t:(this.attachValues(toColorObject(t)),void(e&&(e.style.backgroundColor=this.toRgbString()))):new w3color(t,e)})},{key:"toColorObject",value:function(t){var e,i,r,n,a,s,l,u,o,h,f,c=[],d=[],y=[];if(e=(t=this.w3trim(t.toLowerCase())).substr(0,1).toUpperCase(),i=t.substr(1),u=1,"R"!=e&&"Y"!=e&&"G"!=e&&"C"!=e&&"B"!=e&&"M"!=e&&"W"!=e||isNaN(i)||6==t.length&&-1==t.indexOf(",")||(t="ncol("+t+")"),3==t.length||6==t.length||isNaN(t)||(t="ncol("+t+")"),t.indexOf(",")>0&&-1==t.indexOf("(")&&(t="ncol("+t+")"),"rgb"==t.substr(0,3)||"hsl"==t.substr(0,3)||"hwb"==t.substr(0,3)||"ncol"==t.substr(0,4)||"cmyk"==t.substr(0,4)){if("ncol"==t.substr(0,4)?(4==t.split(",").length&&-1==t.indexOf("ncola")&&(t=t.replace("ncol","ncola")),r="ncol",t=t.substr(4)):"cmyk"==t.substr(0,4)?(r="cmyk",t=t.substr(4)):(r=t.substr(0,3),t=t.substr(3)),n=3,s=!1,"a"==t.substr(0,1).toLowerCase()?(n=4,s=!0,t=t.substr(1)):"cmyk"==r&&(n=4,5==t.split(",").length&&(n=5,s=!0)),c=(t=(t=t.replace("(","")).replace(")","")).split(","),"rgb"==r){if(c.length!=n)return this.emptyObject();for(a=0;a<n;a++){if(""!=c[a]&&" "!=c[a]||(c[a]="0"),c[a].indexOf("%")>-1&&(c[a]=c[a].replace("%",""),c[a]=Number(c[a]/100),a<3&&(c[a]=Math.round(255*c[a]))),isNaN(c[a]))return this.emptyObject();parseInt(c[a])>255&&(c[a]=255),a<3&&(c[a]=parseInt(c[a])),3==a&&Number(c[a])>1&&(c[a]=1)}f={r:c[0],g:c[1],b:c[2]},1==s&&(u=Number(c[3]))}if("hsl"==r||"hwb"==r||"ncol"==r){for(;c.length<n;)c.push("0");for("hsl"!=r&&"hwb"!=r||parseInt(c[0])>=360&&(c[0]=0),a=1;a<n;a++){if(c[a].indexOf("%")>-1){if(c[a]=c[a].replace("%",""),c[a]=Number(c[a]),isNaN(c[a]))return this.emptyObject();c[a]=c[a]/100}else c[a]=Number(c[a]);Number(c[a])>1&&(c[a]=1),Number(c[a])<0&&(c[a]=0)}"hsl"==r&&(f=this.hslToRgb(c[0],c[1],c[2]),o=Number(c[0]),h=Number(c[1])),"hwb"==r&&(f=this.hwbToRgb(c[0],c[1],c[2])),"ncol"==r&&(f=this.ncolToRgb(c[0],c[1],c[2])),1==s&&(u=Number(c[3]))}if("cmyk"==r){for(;c.length<n;)c.push("0");for(a=0;a<n;a++){if(c[a].indexOf("%")>-1){if(c[a]=c[a].replace("%",""),c[a]=Number(c[a]),isNaN(c[a]))return this.emptyObject();c[a]=c[a]/100}else c[a]=Number(c[a]);Number(c[a])>1&&(c[a]=1),Number(c[a])<0&&(c[a]=0)}f=this.cmykToRgb(c[0],c[1],c[2],c[3]),1==s&&(u=Number(c[4]))}}else if("ncs"==t.substr(0,3))f=this.ncsToRgb(t);else{for(l=!1,d=this.getColorArr("names"),a=0;a<d.length;a++)if(t.toLowerCase()==d[a].toLowerCase()){y=this.getColorArr("hexs"),l=!0,f={r:parseInt(y[a].substr(0,2),16),g:parseInt(y[a].substr(2,2),16),b:parseInt(y[a].substr(4,2),16)};break}if(0==l){for(3==(t=t.replace("#","")).length&&(t=t.substr(0,1)+t.substr(0,1)+t.substr(1,1)+t.substr(1,1)+t.substr(2,1)+t.substr(2,1)),a=0;a<t.length;a++)if(!this.isHex(t.substr(a,1)))return this.emptyObject();for(c[0]=parseInt(t.substr(0,2),16),c[1]=parseInt(t.substr(2,2),16),c[2]=parseInt(t.substr(4,2),16),a=0;a<3;a++)if(isNaN(c[a]))return this.emptyObject();f={r:c[0],g:c[1],b:c[2]}}}return this.colorObject(f,u,o,h)}},{key:"colorObject",value:function(t,e,i,r){var n,a,s,l,u,o,h;return t?(e||(e=1),n=this.rgbToHsl(t.r,t.g,t.b),a=this.rgbToHwb(t.r,t.g,t.b),s=this.rgbToCmyk(t.r,t.g,t.b),o=i||n.h,h=r||n.s,l=this.hueToNcol(o),u={red:t.r,green:t.g,blue:t.b,hue:o,sat:h,lightness:n.l,whiteness:a.w,blackness:a.b,cyan:s.c,magenta:s.m,yellow:s.y,black:s.k,ncol:l,opacity:e,valid:!0},u=this.roundDecimals(u)):this.emptyObject()}},{key:"emptyObject",value:function(){return{red:0,green:0,blue:0,hue:0,sat:0,lightness:0,whiteness:0,blackness:0,cyan:0,magenta:0,yellow:0,black:0,ncol:"R",opacity:1,valid:!1}}},{key:"getColorArr",value:function(t){return"names"==t?["AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","BurlyWood","CadetBlue","Chartreuse","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenRod","DarkGray","DarkGrey","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkSlateGrey","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DimGrey","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","Gainsboro","GhostWhite","Gold","GoldenRod","Gray","Grey","Green","GreenYellow","HoneyDew","HotPink","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGrey","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Magenta","Maroon","MediumAquaMarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","RebeccaPurple","Red","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"]:"hexs"==t?["f0f8ff","faebd7","00ffff","7fffd4","f0ffff","f5f5dc","ffe4c4","000000","ffebcd","0000ff","8a2be2","a52a2a","deb887","5f9ea0","7fff00","d2691e","ff7f50","6495ed","fff8dc","dc143c","00ffff","00008b","008b8b","b8860b","a9a9a9","a9a9a9","006400","bdb76b","8b008b","556b2f","ff8c00","9932cc","8b0000","e9967a","8fbc8f","483d8b","2f4f4f","2f4f4f","00ced1","9400d3","ff1493","00bfff","696969","696969","1e90ff","b22222","fffaf0","228b22","ff00ff","dcdcdc","f8f8ff","ffd700","daa520","808080","808080","008000","adff2f","f0fff0","ff69b4","cd5c5c","4b0082","fffff0","f0e68c","e6e6fa","fff0f5","7cfc00","fffacd","add8e6","f08080","e0ffff","fafad2","d3d3d3","d3d3d3","90ee90","ffb6c1","ffa07a","20b2aa","87cefa","778899","778899","b0c4de","ffffe0","00ff00","32cd32","faf0e6","ff00ff","800000","66cdaa","0000cd","ba55d3","9370db","3cb371","7b68ee","00fa9a","48d1cc","c71585","191970","f5fffa","ffe4e1","ffe4b5","ffdead","000080","fdf5e6","808000","6b8e23","ffa500","ff4500","da70d6","eee8aa","98fb98","afeeee","db7093","ffefd5","ffdab9","cd853f","ffc0cb","dda0dd","b0e0e6","800080","663399","ff0000","bc8f8f","4169e1","8b4513","fa8072","f4a460","2e8b57","fff5ee","a0522d","c0c0c0","87ceeb","6a5acd","708090","708090","fffafa","00ff7f","4682b4","d2b48c","008080","d8bfd8","ff6347","40e0d0","ee82ee","f5deb3","ffffff","f5f5f5","ffff00","9acd32"]:void 0}},{key:"roundDecimals",value:function(t){return t.red=Number(t.red.toFixed(0)),t.green=Number(t.green.toFixed(0)),t.blue=Number(t.blue.toFixed(0)),t.hue=Number(t.hue.toFixed(0)),t.sat=Number(t.sat.toFixed(2)),t.lightness=Number(t.lightness.toFixed(2)),t.whiteness=Number(t.whiteness.toFixed(2)),t.blackness=Number(t.blackness.toFixed(2)),t.cyan=Number(t.cyan.toFixed(2)),t.magenta=Number(t.magenta.toFixed(2)),t.yellow=Number(t.yellow.toFixed(2)),t.black=Number(t.black.toFixed(2)),t.ncol=t.ncol.substr(0,1)+Math.round(Number(t.ncol.substr(1))),t.opacity=Number(t.opacity.toFixed(2)),t}},{key:"hslToRgb",value:function(t,e,i){var r,n;return t/=60,r=2*i-(n=i<=.5?i*(e+1):i+e-i*e),{r:255*hueToRgb(r,n,t+2),g:255*hueToRgb(r,n,t),b:255*hueToRgb(r,n,t-2)}}},{key:"hueToRgb",value:function(t,e,i){return i<0&&(i+=6),i>=6&&(i-=6),i<1?(e-t)*i+t:i<3?e:i<4?(e-t)*(4-i)+t:t}},{key:"hwbToRgb",value:function(t,e,i){var r,n,a,s=[];for(n=hslToRgb(t,1,.5),s[0]=n.r/255,s[1]=n.g/255,s[2]=n.b/255,(a=e+i)>1&&(e=Number((e/a).toFixed(2)),i=Number((i/a).toFixed(2))),r=0;r<3;r++)s[r]*=1-e-i,s[r]+=e,s[r]=Number(255*s[r]);return{r:s[0],g:s[1],b:s[2]}}},{key:"cmykToRgb",value:function(t,e,i,r){return{r:255-255*Math.min(1,t*(1-r)+r),g:255-255*Math.min(1,e*(1-r)+r),b:255-255*Math.min(1,i*(1-r)+r)}}},{key:"ncolToRgb",value:function(t,e,i){var r,n,a;if(a=t,isNaN(t.substr(0,1))){if(r=t.substr(0,1).toUpperCase(),""==(n=t.substr(1))&&(n=0),n=Number(n),isNaN(n))return!1;"R"==r&&(a=0+.6*n),"Y"==r&&(a=60+.6*n),"G"==r&&(a=120+.6*n),"C"==r&&(a=180+.6*n),"B"==r&&(a=240+.6*n),"M"==r&&(a=300+.6*n),"W"==r&&(a=0,e=1-n/100,i=n/100)}return hwbToRgb(a,e,i)}},{key:"hueToNcol",value:function(t){for(;t>=360;)t-=360;return t<60?"R"+t/.6:t<120?"Y"+(t-60)/.6:t<180?"G"+(t-120)/.6:t<240?"C"+(t-180)/.6:t<300?"B"+(t-240)/.6:t<360?"M"+(t-300)/.6:void 0}},{key:"ncsToRgb",value:function(t){var e,i,r,n,a,s,l,u,o,h,f,c,d,y,g,v,p;if(-1==(t=(t=(t=(t=(t=w3trim(t).toUpperCase()).replace("(","")).replace(")","")).replace("NCS","NCS ")).replace(/  /g," ")).indexOf("NCS")&&(t="NCS "+t),null===(t=t.match(/^(?:NCS|NCS\sS)\s(\d{2})(\d{2})-(N|[A-Z])(\d{2})?([A-Z])?$/)))return!1;if(e=parseInt(t[1],10),i=parseInt(t[2],10),"N"!=(r=t[3])&&"Y"!=r&&"R"!=r&&"B"!=r&&"G"!=r)return!1;if(n=parseInt(t[4],10)||0,"N"!==r){a=1.05*e-5.25,s=i,"Y"===r&&n<=60?o=1:"Y"===r&&n>60||"R"===r&&n<=80?(l="Y"===r?n-60:n+40,o=(Math.sqrt(14884-Math.pow(l,2))-22)/100):"R"===r&&n>80||"B"===r?o=0:"G"===r&&(l=n-170,o=(Math.sqrt(33800-Math.pow(l,2))-70)/100),"Y"===r&&n<=80?u=0:"Y"===r&&n>80||"R"===r&&n<=60?(l="Y"===r?n-80+20.5:n+20+20.5,u=(104-Math.sqrt(11236-Math.pow(l,2)))/100):"R"===r&&n>60||"B"===r&&n<=80?(l="R"===r?n-60-60:n+40-60,u=(Math.sqrt(1e4-Math.pow(l,2))-10)/100):"B"===r&&n>80||"G"===r&&n<=40?(l="B"===r?n-80-131:n+20-131,u=(122-Math.sqrt(19881-Math.pow(l,2)))/100):"G"===r&&n>40&&(u=0);var x=void 0;"Y"===r?x=(85-.85*n)/100:"R"===r&&n<=60?x=0:"R"===r&&n>60?(l=n-60+35,x=(67.5-Math.sqrt(5776-Math.pow(l,2)))/100):"B"===r&&n<=60?(l=1*n-68.5,x=(6.5+Math.sqrt(7044.5-Math.pow(l,2)))/100):"B"===r&&n>60||"G"===r&&n<=60?x=.9:"G"===r&&n>60&&(x=(90-1/8*(l=n-60))/100),c=((l=(o+x+u)/3)-u)*(100-s)/100+u,d=1/((h=(l-o)*(100-s)/100+o)>(f=(l-x)*(100-s)/100+x)&&h>c?h:f>h&&f>c?f:c>h&&c>f?c:(h+f+c)/3),(g=parseInt(h*d*(100-a)/100*255,10))>255&&(g=255),(v=parseInt(f*d*(100-a)/100*255,10))>255&&(v=255),(p=parseInt(c*d*(100-a)/100*255,10))>255&&(p=255),g<0&&(g=0),v<0&&(v=0),p<0&&(p=0)}else(y=parseInt(255*(1-e/100),10))>255&&(y=255),y<0&&(y=0),g=y,v=y,p=y;return{r:g,g:v,b:p}}},{key:"rgbToHsl",value:function(t,e,i){var r,n,a,s,l,u,o=[];for(o[0]=t/255,o[1]=e/255,o[2]=i/255,r=o[0],n=o[0],l=0,a=0;a<o.length-1;a++)o[a+1]<=r&&(r=o[a+1]),o[a+1]>=n&&(n=o[a+1],l=a+1);return 0==l&&(u=(o[1]-o[2])/(n-r)),1==l&&(u=2+(o[2]-o[0])/(n-r)),2==l&&(u=4+(o[0]-o[1])/(n-r)),isNaN(u)&&(u=0),(u*=60)<0&&(u+=360),s=(r+n)/2,{h:u,s:r==n?0:s<.5?(n-r)/(n+r):(n-r)/(2-n-r),l:s}}},{key:"rgbToHwb",value:function(t,e,i){t/=255,e/=255,i/=255;var r=Math.max(t,e,i),n=Math.min(t,e,i),a=r-n;return{h:0==a?0:t==r?(e-i)/a%6*360:e==r?((i-t)/a+2)%6*360:((t-e)/a+4)%6*360,w:n,b:1-r}}},{key:"rgbToCmyk",value:function(t,e,i){var r,n,a,s;return t/=255,e/=255,i/=255,1==(s=1-Math.max(t,e,i))?(r=0,n=0,a=0):(r=(1-t-s)/(1-s),n=(1-e-s)/(1-s),a=(1-i-s)/(1-s)),{c:r,m:n,y:a,k:s}}},{key:"toHex",value:function(t){for(var e=t.toString(16);e.length<2;)e="0"+e;return e}},{key:"cl",value:function(t){console.log(t)}},{key:"w3trim",value:function(t){return t.replace(/^\s+|\s+$/g,"")}},{key:"isHex",value:function(t){return"0123456789ABCDEFabcdef".indexOf(t)>-1}}]),t}();e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=s(i(20)),a=s(i(5));function s(t){return t&&t.__esModule?t:{default:t}}var l=[0,1,2],u=[0,1,2,2,3,0],o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=e,this.textureIndex=-1,this.verticesData=null,this.fragmentData=null,this.transformData=null,this.renderPointNumber=0,this.isRect=!1,this.indexData=null,this.applyMatrix=null,this.applyColor=null,this.applyOpacity=null}return r(t,[{key:"collectVertexDataForStroke",value:function(t,e,i,r,n,s,l){for(var u=this,o=this,h={setPoint:function(t,e){o.verticesData.setVerticesCoor(t.x,t.y,t.z,e+h.offset)},addPoint:function(t){null!=o.verticesData&&o.verticesData.addVerticesData(t.x,t.y,t.z,l[0],l[1],l[2]),null!=o.fragmentData&&o.fragmentData.addFragmentData(e[0],e[1],e[2],i,r[0],r[1],-1,s),null!=o.transformData&&o.transformData.addMatrixIndex(0)}},f=0;f<t.length;f++)for(var c=t[f],d=function(t){var e=c.subPathArray[t];if(e.pointsNumber<2)return"continue";h.offset=u.verticesData.currentIndex;for(var i=e.pointsCoordinateArray,r={getX:function(t){return i[t*=3]},getY:function(t){return i[1+(t*=3)]},getZ:function(t){return i[2+(t*=3)]},getPointsNum:function(){return i.length/3}},s=a.default.generateRectanglesPoints(n,e.isClosed,l,h,r),o=0;o<s;o++){var f=4*o;u.indexData.addIndex(h.offset+f),u.indexData.addIndex(h.offset+f+1),u.indexData.addIndex(h.offset+f+2),u.indexData.addIndex(h.offset+f+2),u.indexData.addIndex(h.offset+f+3),u.indexData.addIndex(h.offset+f)}u.renderPointNumber+=6*s},y=0;y<c.subPathNumber;y++)d(y)}},{key:"collectVertexDataForFill",value:function(t,e,i,r,a,s){for(var o=0;o<t.length;o++){var h=t[o];if(0!=h.subPathNumber)for(var f=0;f<h.subPathNumber;f++){var c=h.subPathArray[f];if(!(c.pointsNumber<3)){var d=void 0,y=c.pointsCoordinateArray,g=c.pointsNumber;if(3==g)d=l;else if(4==g&&c.isRegularRect)d=u;else if(3*g==y.length)d=n.default.earcut(y,null,3);else{var v=y.slice(0,3*g);d=n.default.earcut(v,null,3)}if(this.renderPointNumber+=d.length,0!=d.length){var p=this.verticesData.currentIndex,x=void 0;for(x=0;x<g;x++){if(null!=this.verticesData&&this.verticesData.addVerticesData(c.getPointX(x),c.getPointY(x),c.getPointZ(x),s[0],s[1],s[2]),null!=this.fragmentData){var m=void 0;m=r[0]instanceof Array?r[x]:r,this.fragmentData.addFragmentData(e[0],e[1],e[2],i,m[0],m[1],this.textureIndex,a)}null!=this.transformData&&this.transformData.addMatrixIndex(0);var b=d[x];this.indexData.addIndex(b+p)}for(var M=x;M<d.length;M++){var w=d[M];this.indexData.addIndex(w+p)}}}}}}}],[{key:"ACTION_STROKE",get:function(){return 0}},{key:"ACTION_FILL",get:function(){return 1}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),a=i(21),s=(r=a)&&r.__esModule?r:{default:r},l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return n(t,null,[{key:"earcut",value:function(t,e,i){i=i||2;var r=e&&e.length,n=r?e[0]*i:t.length,a=this.linkedList(t,0,n,i,!0),s=[];if(!a||a.next===a.prev)return s;var l=void 0,u=void 0,o=void 0,h=void 0,f=void 0,c=void 0,d=void 0;if(r&&(a=this.eliminateHoles(t,e,a,i)),t.length>80*i){l=o=t[0],u=h=t[1];for(var y=i;y<n;y+=i)(f=t[y])<l&&(l=f),(c=t[y+1])<u&&(u=c),f>o&&(o=f),c>h&&(h=c);d=0!==(d=Math.max(o-l,h-u))?1/d:0}return this.earcutLinked(a,s,i,l,u,d),s}},{key:"linkedList",value:function(e,i,r,n,a){var s,l;if(a===t.signedArea(e,i,r,n)>0)for(s=i;s<r;s+=n)l=this.insertNode(s,e[s],e[s+1],l);else for(s=r-n;s>=i;s-=n)l=this.insertNode(s,e[s],e[s+1],l);return l&&t.equals(l,l.next)&&(this.removeNode(l),l=l.next),l}},{key:"filterPoints",value:function(e,i){if(!e)return e;i||(i=e);var r,n=e;do{if(r=!1,n.steiner||!t.equals(n,n.next)&&0!==t.area(n.prev,n,n.next))n=n.next;else{if(this.removeNode(n),(n=i=n.prev)===n.next)break;r=!0}}while(r||n!==i);return i}},{key:"earcutLinked",value:function(t,e,i,r,n,a,s){if(t){!s&&a&&this.indexCurve(t,r,n,a);for(var l,u,o=t;t.prev!==t.next;)if(l=t.prev,u=t.next,a?this.isEarHashed(t,r,n,a):this.isEar(t))e.push(l.i/i),e.push(t.i/i),e.push(u.i/i),this.removeNode(t),t=u.next,o=u.next;else if((t=u)===o){s?1===s?(t=this.cureLocalIntersections(t,e,i),this.earcutLinked(t,e,i,r,n,a,2)):2===s&&this.splitEarcut(t,e,i,r,n,a):this.earcutLinked(this.filterPoints(t),e,i,r,n,a,1);break}}}},{key:"isEar",value:function(e){var i=e.prev,r=e,n=e.next;if(this.area(i,r,n)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(this.pointInTriangle(i.x,i.y,r.x,r.y,n.x,n.y,a.x,a.y)&&t.area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}},{key:"isEarHashed",value:function(e,i,r,n){var a=e.prev,s=e,l=e.next;if(this.area(a,s,l)>=0)return!1;for(var u=a.x<s.x?a.x<l.x?a.x:l.x:s.x<l.x?s.x:l.x,o=a.y<s.y?a.y<l.y?a.y:l.y:s.y<l.y?s.y:l.y,h=a.x>s.x?a.x>l.x?a.x:l.x:s.x>l.x?s.x:l.x,f=a.y>s.y?a.y>l.y?a.y:l.y:s.y>l.y?s.y:l.y,c=this.zOrder(u,o,i,r,n),d=this.zOrder(h,f,i,r,n),y=e.prevZ,g=e.nextZ;y&&y.z>=c&&g&&g.z<=d;){if(y!==e.prev&&y!==e.next&&this.pointInTriangle(a.x,a.y,s.x,s.y,l.x,l.y,y.x,y.y)&&t.area(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,g!==e.prev&&g!==e.next&&this.pointInTriangle(a.x,a.y,s.x,s.y,l.x,l.y,g.x,g.y)&&t.area(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;y&&y.z>=c;){if(y!==e.prev&&y!==e.next&&this.pointInTriangle(a.x,a.y,s.x,s.y,l.x,l.y,y.x,y.y)&&t.area(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;g&&g.z<=d;){if(g!==e.prev&&g!==e.next&&this.pointInTriangle(a.x,a.y,s.x,s.y,l.x,l.y,g.x,g.y)&&t.area(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}},{key:"cureLocalIntersections",value:function(e,i,r){var n=e;do{var a=n.prev,s=n.next.next;!t.equals(a,s)&&this.intersects(a,n,n.next,s)&&this.locallyInside(a,s)&&this.locallyInside(s,a)&&(i.push(a.i/r),i.push(n.i/r),i.push(s.i/r),this.removeNode(n),this.removeNode(n.next),n=e=s),n=n.next}while(n!==e);return n}},{key:"splitEarcut",value:function(t,e,i,r,n,a){var s=t;do{for(var l=s.next.next;l!==s.prev;){if(s.i!==l.i&&this.isValidDiagonal(s,l)){var u=this.splitPolygon(s,l);return s=this.filterPoints(s,s.next),u=this.filterPoints(u,u.next),this.earcutLinked(s,e,i,r,n,a),void this.earcutLinked(u,e,i,r,n,a)}l=l.next}s=s.next}while(s!==t)}},{key:"eliminateHoles",value:function(t,e,i,r){var n,a,s,l,u,o=[];for(n=0,a=e.length;n<a;n++)s=e[n]*r,l=n<a-1?e[n+1]*r:t.length,(u=this.linkedList(t,s,l,r,!1))===u.next&&(u.steiner=!0),o.push(this.getLeftmost(u));for(o.sort(this.compareX),n=0;n<o.length;n++)this.eliminateHole(o[n],i),i=this.filterPoints(i,i.next);return i}},{key:"compareX",value:function(t,e){return t.x-e.x}},{key:"eliminateHole",value:function(t,e){if(e=this.findHoleBridge(t,e)){var i=this.splitPolygon(e,t);this.filterPoints(i,i.next)}}},{key:"findHoleBridge",value:function(t,e){var i,r=e,n=t.x,a=t.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var l=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(l<=n&&l>s){if(s=l,l===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===s)return i.prev;var u,o=i,h=i.x,f=i.y,c=1/0;for(r=i.next;r!==o;)n>=r.x&&r.x>=h&&n!==r.x&&this.pointInTriangle(a<f?n:s,a,h,f,a<f?s:n,a,r.x,r.y)&&((u=Math.abs(a-r.y)/(n-r.x))<c||u===c&&r.x>i.x)&&this.locallyInside(r,t)&&(i=r,c=u),r=r.next;return i}},{key:"indexCurve",value:function(t,e,i,r){var n=t;do{null===n.z&&(n.z=this.zOrder(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,this.sortLinked(n)}},{key:"sortLinked",value:function(t){var e,i,r,n,a,s,l,u,o=1;do{for(i=t,t=null,a=null,s=0;i;){for(s++,r=i,l=0,e=0;e<o&&(l++,r=r.nextZ);e++);for(u=o;l>0||u>0&&r;)0!==l&&(0===u||!r||i.z<=r.z)?(n=i,i=i.nextZ,l--):(n=r,r=r.nextZ,u--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;i=r}a.nextZ=null,o*=2}while(s>1);return t}},{key:"zOrder",value:function(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}},{key:"getLeftmost",value:function(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}},{key:"pointInTriangle",value:function(t,e,i,r,n,a,s,l){return(n-s)*(e-l)-(t-s)*(a-l)>=0&&(t-s)*(r-l)-(i-s)*(e-l)>=0&&(i-s)*(a-l)-(n-s)*(r-l)>=0}},{key:"isValidDiagonal",value:function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!this.intersectsPolygon(t,e)&&this.locallyInside(t,e)&&this.locallyInside(e,t)&&this.middleInside(t,e)}},{key:"area",value:function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}},{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"intersects",value:function(e,i,r,n){return!!(t.equals(e,i)&&t.equals(r,n)||t.equals(e,n)&&t.equals(r,i))||t.area(e,i,r)>0!=t.area(e,i,n)>0&&t.area(r,n,e)>0!=t.area(r,n,i)>0}},{key:"intersectsPolygon",value:function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&this.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}},{key:"locallyInside",value:function(e,i){return t.area(e.prev,e,e.next)<0?t.area(e,i,e.next)>=0&&t.area(e,e.prev,i)>=0:t.area(e,i,e.prev)<0||t.area(e,e.next,i)<0}},{key:"middleInside",value:function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}},{key:"splitPolygon",value:function(t,e){var i=new s.default(t.i,t.x,t.y),r=new s.default(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}},{key:"insertNode",value:function(t,e,i,r){var n=new s.default(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}},{key:"removeNode",value:function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}},{key:"signedArea",value:function(t,e,i,r){for(var n=0,a=e,s=i-r;a<i;a+=r)n+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return n}},{key:"deviation",value:function(t,e,i,r){var n=e&&e.length,a=n?e[0]*i:t.length,s=Math.abs(this.signedArea(t,0,a,i));if(n)for(var l=0,u=e.length;l<u;l++){var o=e[l]*i,h=l<u-1?e[l+1]*i:t.length;s-=Math.abs(this.signedArea(t,o,h,i))}var f=0;for(l=0;l<r.length;l+=3){var c=r[l]*i,d=r[l+1]*i,y=r[l+2]*i;f+=Math.abs((t[c]-t[y])*(t[d+1]-t[c+1])-(t[c]-t[d])*(t[y+1]-t[c+1]))}return 0===s&&0===f?0:Math.abs((f-s)/s)}},{key:"flatten",value:function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var a=0;a<t[n].length;a++)for(var s=0;s<e;s++)i.vertices.push(t[n][a][s]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.i=e,this.x=i,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=s(i(7)),a=s(i(1));function s(t){return t&&t.__esModule?t:{default:t}}var l=Symbol("WebGL的program"),u=Symbol("转换矩阵变量可用的最大数量"),o=function(){function t(e,i,r,n,s,l,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e,this.DEBUG_DRAW_COUNT=0,this.defaultTransformMatrix=a.default.identity(),this.orthoProjectionMatrix=a.default.identity(),this.perspectiveMatrix=a.default.identity(),n=n||0,r=r||e.getParameter(this.gl.MAX_TEXTURE_SIZE);var h=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS);i=i||Math.floor((h-4)/4),i=2,this[u]=i,this.enableDepthTest=o||!1,this.textureManager=null,this.verticesData=null,this.fragmentData=null,this.indexData=null,this.transformMatrixData=null,this.canvasWidth=-1,this.canvasHeight=-1,this.lightPosition=new Float32Array(3),this.lightPosition[0]=e.canvas.width/2,this.lightPosition[1]=e.canvas.height/2,this.lightPosition[2]=0,this.projectionType=n,this.fov=s,this.init(),this.textureManager.maxHeight=r,this.textureManager.maxWidth=this.textureManager.maxHeight,l=l||!1,this.enableLight(l)}return r(t,[{key:"enableLight",value:function(t){var e=0;e=t?1:0,this.gl.uniform1f(this.shaderInformation.enableLight,e)}},{key:"clean",value:function(){this.DEBUG_DRAW_COUNT=0,this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}},{key:"initRending",value:function(){var t=this.gl;t.viewport(0,0,t.canvas.width,t.canvas.height)}},{key:"setUniformTransformMatrix",value:function(t,e){this.gl.uniformMatrix4fv(this.shaderInformation.transformMatrixArray[e],!1,t)}},{key:"prepareWebGLBuffer",value:function(){var t=this.gl,e=this.shaderInformation;t.enableVertexAttribArray(e.vertexAttribute),t.bindBuffer(t.ARRAY_BUFFER,e.verticesBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticesData.buffer,t.DYNAMIC_DRAW);var i=3,r=t.FLOAT,n=!1,a=32,s=0;t.vertexAttribPointer(e.vertexAttribute,i,r,n,a,s),r=t.FLOAT,i=3,s=16,n=!0,t.vertexAttribPointer(e.normalAttribute,i,r,n,a,s),t.enableVertexAttribArray(e.colorAttribute),t.enableVertexAttribArray(e.textureCoordAttribute),t.bindBuffer(t.ARRAY_BUFFER,e.fragmentBuffer),t.bufferData(t.ARRAY_BUFFER,this.fragmentData.buffer,t.DYNAMIC_DRAW),r=t.UNSIGNED_BYTE,a=this.fragmentData.singleDataByteLength,i=3,s=0,n=!1,t.vertexAttribPointer(e.colorAttribute,i,r,n,a,s),r=t.UNSIGNED_BYTE,a=this.fragmentData.singleDataByteLength,i=1,s=3,n=!1,t.vertexAttribPointer(e.filterTypeAttribute,i,r,n,a,s),r=t.FLOAT,i=1,s=4,t.vertexAttribPointer(e.alphaAttribute,i,r,n,a,s),r=t.FLOAT,i=2,s=8,t.vertexAttribPointer(e.textureCoordAttribute,i,r,n,a,s),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.indexDataBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indexData.dataArray,t.DYNAMIC_DRAW)}},{key:"executeRenderAction",value:function(t){this.prepareWebGLBuffer();for(var e=void 0,i=0,r=0,n=0;n<t.length;n++){var a=t[n];null==e&&(e=a),a.applyMatrix!=e.applyMatrix?(this.renderVertices(i,r,e.textureIndex,e.applyMatrix),e=a,i+=r,r=a.renderPointNumber):(a.textureIndex!=e.textureIndex&&-1!=a.textureIndex&&-1!=e.textureIndex&&(this.renderVertices(i,r,e.textureIndex,e.applyMatrix),e=a,i+=r,r=0),-1==e.textureIndex&&-1!=a.textureIndex&&(e=a),r+=a.renderPointNumber)}null!=e&&this.renderVertices(i,r,e.textureIndex,e.applyMatrix)}},{key:"renderVertices",value:function(t,e,i,r){if(0!=e){var n=this.gl;if(this.initProjectionMatrix(),null!=r){var s=a.default.identity();a.default.multiply(s,r,this.defaultTransformMatrix),n.uniformMatrix4fv(this.shaderInformation.transformMatrixArray[0],!1,s)}this.gl.uniform3f(this.shaderInformation.lightPosition,this.lightPosition[0],this.lightPosition[1],this.lightPosition[2]),this.configTexture(i),n.drawElements(n.TRIANGLES,e,n.UNSIGNED_SHORT,2*t),this.DEBUG_DRAW_COUNT++}}},{key:"initProjectionMatrix",value:function(){var t=this.gl;if(this.canvasHeight!=t.canvas.height&&this.canvasWidth!=t.canvas.width){var e=Math.tan(this.fov*Math.PI/180),i=-t.canvas.height/(2*e);a.default.identityMatrix(this.defaultTransformMatrix),a.default.translationMatrix(this.defaultTransformMatrix,0,0,i),t.uniformMatrix4fv(this.shaderInformation.transformMatrixArray[0],!1,this.defaultTransformMatrix);var r=void 0;if(0==this.projectionType)r=a.default.orthoProjection(0,0,t.canvas.width,t.canvas.height,1,Math.abs(2*i),this.orthoProjectionMatrix);else{var n=Math.atan2(t.canvas.height/2,Math.abs(i));r=a.default.perspective3(2*n,t.canvas.width,t.canvas.height,1,Math.abs(2*i),this.perspectiveMatrix)}t.uniformMatrix4fv(this.shaderInformation.perspectiveMatrix,!1,r),this.canvasHeight=t.canvas.height,this.canvasWidth=t.canvas.width}}},{key:"setLightPosition",value:function(t,e,i){this.lightPosition[0]=t,this.lightPosition[1]=e,this.lightPosition[2]=i}},{key:"configTexture",value:function(t){null==t&&(t=-1);var e=this.gl,i=this.shaderInformation;e.uniform1i(i.textureLocation,0);var r=void 0,n=void 0;-1==t?(r=i.blackTexture,n={width:1,height:1}):(r=this.textureManager.textureArray[t],n=this.textureManager.imageDataArray[t]),e.uniform2f(i.singleCanvas,n.width,n.height),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,r)}},{key:"createShaderProgram",value:function(){var t=this.gl,e=this.loadShader(t.VERTEX_SHADER,this.getVertexShaderSource(this.maxTransformMatrixNum)),i=this.loadShader(t.FRAGMENT_SHADER,"\n  precision mediump float;\n  varying vec4 currentColor;\n  varying vec2 v_texcoord;\n  varying vec3 normal;\n  varying vec3 v_position;\n  varying float v_filterType;\n  uniform vec2 singleCanvas;\n  uniform vec3 u_lightPosition;\n  uniform float enableLight;\n  uniform sampler2D u_texture;\n  \n  void getNormalFilter(inout float filter[9]){\n        filter[0] = 0.0;\n        filter[1] = 0.0;\n        filter[2] = 0.0;\n        filter[3] = 0.0;\n        filter[4] = 1.0;\n        filter[5] = 0.0;\n        filter[6] = 0.0;\n        filter[7] = 0.0;\n        filter[8] = 0.0;\n  }\n  \n  void getGaussianBlurFilter(inout float filter[9]){\n        filter[0] = 0.045;\n        filter[1] = 0.122;\n        filter[2] = 0.045;\n        filter[3] = 0.122;\n        filter[4] = 0.332;\n        filter[5] = 0.122;\n        filter[6] = 0.045;\n        filter[7] = 0.122;\n        filter[8] = 0.045;\n  }\n  \n  void getUnsharpenFilter(inout float filter[9]){\n        filter[0] = -1.0;\n        filter[1] = -1.0;\n        filter[2] = -1.0;\n        filter[3] = -1.0;\n        filter[4] = 9.0;\n        filter[5] = -1.0;\n        filter[6] = -1.0;\n        filter[7] = -1.0;\n        filter[8] = -1.0;\n  }\n  \n  void getSharpnessFilter(inout float filter[9]){\n        filter[0] = 0.0;\n        filter[1] = -1.0;\n        filter[2] = 0.0;\n        filter[3] = -1.0;\n        filter[4] = 5.0;\n        filter[5] = -1.0;\n        filter[6] = 0.0;\n        filter[7] = -1.0;\n        filter[8] = 0.0;\n  }\n  \n   void getSharpenFilter(inout float filter[9]){\n        filter[0] = -0.125;\n        filter[1] = -0.125;\n        filter[2] = -0.125;\n        filter[3] = -0.125;\n        filter[4] =  2.0;\n        filter[5] = -0.125;\n        filter[6] = -0.125;\n        filter[7] = -0.125;\n        filter[8] = -0.125;\n  }\n  \n  void getEdgeDetectFilter(inout float filter[9]){\n        filter[0] = -5.0;\n        filter[1] = -5.0;\n        filter[2] = -5.0;\n        filter[3] = -5.0;\n        filter[4] =  39.0;\n        filter[5] = -5.0;\n        filter[6] = -5.0;\n        filter[7] = -5.0;\n        filter[8] = -5.0;\n  }\n  \n  void getSobelHorizontalFilter(inout float filter[9]){\n        filter[0] = 1.0;\n        filter[1] = 2.0;\n        filter[2] = 1.0;\n        filter[3] = 0.0;\n        filter[4] =  0.0;\n        filter[5] = 0.0;\n        filter[6] = -1.0;\n        filter[7] = -2.0;\n        filter[8] = -1.0;\n  }\n  \n  void getSobelVerticalFilter(inout float filter[9]){\n        filter[0] = 1.0;\n        filter[1] = 0.0;\n        filter[2] = -1.0;\n        filter[3] = 2.0;\n        filter[4] =  0.0;\n        filter[5] = -2.0;\n        filter[6] = 1.0;\n        filter[7] = 0.0;\n        filter[8] = -1.0;\n  }\n  \n  void getPrevitHorizontalFilter(inout float filter[9]){\n        filter[0] = 1.0;\n        filter[1] = 1.0;\n        filter[2] = 1.0;\n        filter[3] = 0.0;\n        filter[4] = 0.0;\n        filter[5] = 0.0;\n        filter[6] = -1.0;\n        filter[7] = -1.0;\n        filter[8] = -1.0;\n  }\n  \n  void getPrevitVerticalFilter(inout float filter[9]){\n        filter[0] = 1.0;\n        filter[1] = 0.0;\n        filter[2] = -1.0;\n        filter[3] = 1.0;\n        filter[4] = 0.0;\n        filter[5] = -1.0;\n        filter[6] = 1.0;\n        filter[7] = 0.0;\n        filter[8] = -1.0;\n  }\n  \n  void getBoxBlurFilter(inout float filter[9]){\n        filter[0] = 0.111;\n        filter[1] = 0.111;\n        filter[2] = 0.111;\n        filter[3] = 0.111;\n        filter[4] = 0.111;\n        filter[5] = 0.111;\n        filter[6] = 0.111;\n        filter[7] = 0.111;\n        filter[8] = 0.111;\n  }\n  \n  void getTriangleBlurFilter(inout float filter[9]){\n        filter[0] = 0.0625;\n        filter[1] = 0.125;\n        filter[2] = 0.0625;\n        filter[3] = 0.125;\n        filter[4] = 0.25;\n        filter[5] = 0.125;\n        filter[6] = 0.0625;\n        filter[7] = 0.125;\n        filter[8] = 0.0625;\n  }\n  \n  void getEmbossFilter(inout float filter[9]){\n        filter[0] = -2.0;\n        filter[1] = -1.0;\n        filter[2] = 0.0;\n        filter[3] = -1.0;\n        filter[4] = 1.0;\n        filter[5] = 1.0;\n        filter[6] = 0.0;\n        filter[7] = 1.0;\n        filter[8] = 2.0;\n  }\n  \n  void filter3(in float kernel[9],in vec2 coord,in vec2 onePixel, inout vec4 colorSum){\n        float offset = -1.0;\n        for(float i = 0.0 ; i < 3.0;i++){\n            for(float j =0.0;j < 3.0;j++){\n                colorSum += texture2D(u_texture, coord + onePixel * vec2(offset + j, offset+ i)) * kernel[int(i*3.0+j)];\n            }\n        }\n  }\n  \n  void filter5(in float kernel[25],in vec2 coord,in vec2 onePixel, inout vec4 colorSum){\n        float offset = -2.0;\n        for(float i = 0.0 ; i < 5.0;i++){\n            for(float j =0.0;j < 5.0;j++){\n                colorSum += texture2D(u_texture, coord + onePixel * vec2(offset + j, offset+ i)) * kernel[int(i*5.0+j)];\n            }\n        }\n  }\n  \n  void main() {\n        vec2 coord = vec2(v_texcoord.x / singleCanvas.x , v_texcoord.y/singleCanvas.y);\n        vec2 onePixel = vec2(1.0/singleCanvas.x, 1.0/singleCanvas.y);\n        vec4 color = currentColor;\n        float opacity = texture2D(u_texture, coord).a * color.a;\n        float kernel3[9];\n        float kernel5[25];\n        vec4 colorSum = vec4(0.0,0.0,0.0,0.0);\n        \n        if(int(v_filterType) == 0){\n            getNormalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 1){\n            getGaussianBlurFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 2){\n            getUnsharpenFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }\n        else\n        if(int(v_filterType) == 3){\n            getSharpnessFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 4){\n            getSharpenFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 5){\n            getEdgeDetectFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 6){\n            getSobelHorizontalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 7){\n            getSobelVerticalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 8){\n            getPrevitHorizontalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 9){\n            getPrevitVerticalFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 10){\n            getBoxBlurFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 11){\n            getTriangleBlurFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }else\n        if(int(v_filterType) == 12){\n            getEmbossFilter(kernel3);\n            filter3(kernel3,coord,onePixel,colorSum);\n        }\n\n        \n        // colorSum.w = opacity;\n        // colorSum = texture2D(u_texture, coord);\n        vec3 r_normal = normalize(normal);    \n        vec3 forward = u_lightPosition - v_position;\n        vec3 lightLocation = normalize(forward);    \n        gl_FragColor = color * colorSum;//texture2D(u_texture, coord);\n        gl_FragColor.w = opacity;\n        if(enableLight == 1.0){\n            gl_FragColor.rgb *= abs(dot(r_normal,lightLocation));\n        }\n  }\n  "),r=t.createProgram();return t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)?(t.useProgram(r),r):(console.error("无法初始化Program: "+t.getProgramInfoLog(r)),t.deleteProgram(r),null)}},{key:"init",value:function(){var t=this.gl;this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.enableDepthTest?t.enable(t.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this[l]=this.createShaderProgram();var e=this[l];this.shaderInformation=this.initShaderInformation(e),this.textureManager=new n.default(801,801,10,4)}},{key:"initShaderInformation",value:function(t){var e=this.gl,i=e.getAttribLocation(t,"u_texCoord");e.enableVertexAttribArray(i);var r=e.getAttribLocation(t,"u_filterType");e.enableVertexAttribArray(r);var n=e.getAttribLocation(t,"a_position");e.enableVertexAttribArray(n);var a=e.getAttribLocation(t,"a_normal");e.enableVertexAttribArray(a);var s=e.getAttribLocation(t,"color");e.enableVertexAttribArray(s);var l=e.getAttribLocation(t,"alpha");e.enableVertexAttribArray(l);for(var u=e.getUniformLocation(t,"perspective_matrix"),o=new Array(this.maxTransformMatrixNum),h=0;h<o.length;h++)o[h]=e.getUniformLocation(t,"transform_matrix_array["+h+"]");var f=e.getUniformLocation(t,"singleCanvas"),c=e.getUniformLocation(t,"u_lightPosition"),d=e.getUniformLocation(t,"enableLight"),y=e.getUniformLocation(t,"u_texture"),g=e.createBuffer(),v=e.createBuffer(),p=e.createBuffer(),x=e.createBuffer(),m=e.createTexture();e.bindTexture(e.TEXTURE_2D,m);var b=new Uint8Array([255,255,255,255]);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,b),e.bindTexture(e.TEXTURE_2D,null),{vertexAttribute:n,normalAttribute:a,colorAttribute:s,filterTypeAttribute:r,alphaAttribute:l,textureCoordAttribute:i,verticesBuffer:g,fragmentBuffer:p,matrixIndexBuffer:v,indexDataBuffer:x,perspectiveMatrix:u,transformMatrixArray:o,singleCanvas:f,textureLocation:y,blackTexture:m,lightPosition:c,enableLight:d,webgl:e}}},{key:"loadShader",value:function(t,e){var i=this.gl,r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)?r:(console.error("着色器编译错误: "+i.getShaderInfoLog(r)),i.deleteShader(r),null)}},{key:"getVertexShaderSource",value:function(t){return" attribute vec3 color;\n     attribute vec4 a_position;\n     attribute vec3 a_normal;\n     attribute float alpha;\n     attribute vec2 u_texCoord;\n     attribute float u_filterType;\n     varying vec3 v_position;\n     varying float v_filterType;\n     attribute float transform_matrix_index;\n     varying vec2 v_texcoord;\n     varying vec4 currentColor;\n     varying vec3 normal;\n     uniform mat4 perspective_matrix;\n     uniform mat4 transform_matrix_array["+t+"];\n     void main() {\n            normal = a_normal;\n            float ft = u_filterType;\n            v_filterType = u_filterType + 0.5;\n            vec4 yuandian = vec4(0,0,0,1);\n            v_texcoord = u_texCoord;\n            vec4 new_position = transform_matrix_array[0] * a_position;\n            v_position = vec3(new_position.xyz);\n            vec4 finalPosition = perspective_matrix* new_position;\n            currentColor = vec4 (color.xyz/255.0,alpha);\n            gl_Position = finalPosition;\n    }"}},{key:"maxTransformMatrixNum",get:function(){return this[u]}}]),t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"undefined"!=typeof wx?wx.createCanvas():document.createElement("canvas")}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=Symbol("当前顶点游标位置"),a=Symbol("Float32的typed数组"),s=Symbol("存储顶点数组的buffer"),l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[s]=new ArrayBuffer(4*e*2*4),this[a]=new Float32Array(this[s]),this[n]=0}return r(t,[{key:"init",value:function(){this[n]=0}},{key:"setVerticesData",value:function(t,e,i,r,n,s,l){4*(l*=8)>=this.totalByteLength&&this.resize(2*this.totalByteLength),this[a][l]=t,this[a][l+1]=e,this[a][l+2]=i,this[a][l+4]=r,this[a][l+5]=n,this[a][l+6]=s}},{key:"setVerticesCoor",value:function(t,e,i,r){4*(r*=8)>=this.totalByteLength&&this.resize(2*this.totalByteLength),this[a][r]=t,this[a][r+1]=e,this[a][r+2]=i}},{key:"getVerticesData",value:function(t){return t*=8,[this[a][t],this[a][t+1],this[a][t+2],this[a][t+4],this[a][t+5],this[a][t+6]]}},{key:"getVerticesPositionData",value:function(t){return t*=8,[this[a][t],this[a][t+1],this[a][t+2]]}},{key:"getVerticesNormalData",value:function(t){return t*=8,[this[a][t+4],this[a][t+5],this[a][t+6]]}},{key:"addVerticesData",value:function(t,e,i,r,a,s){var l=this[n];this.setVerticesData(t,e,i,r,a,s,l),this[n]++}},{key:"resize",value:function(t){if(!(t<=this.totalByteLength)){var e=this[s];this[s]=new ArrayBuffer(t);var i=new Uint8Array(e);new Uint8Array(this[s]).set(i,0),this[a]=new Float32Array(this[s])}}},{key:"append",value:function(t){var e=this.currentIndex,i=t.totalByteLength;this.resize(i+32*e);var r=new Uint8Array(t.buffer);new Uint8Array(this[s]).set(r,32*e),this[n]+=t.currentIndex}},{key:"singleDataByteLength",get:function(){return 32}},{key:"totalByteLength",get:function(){return this[s].byteLength}},{key:"buffer",get:function(){return this[s]}},{key:"currentIndex",get:function(){return this[n]}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=(a(i(9)),a(i(0)));function a(t){return t&&t.__esModule?t:{default:t}}var s=16,l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.buffer=new ArrayBuffer(e*s),this.dv=new DataView(this.buffer),this.currentIndex=0,this.isLittleEndian=n.default.littleEndian}return r(t,[{key:"setFragmentData",value:function(t,e,i,r,n,a,s,l,u){u*=this.singleDataByteLength,this.dv.setUint8(u,t),this.dv.setUint8(u+1,e),this.dv.setUint8(u+2,i),this.dv.setUint8(u+3,l),u+=4,this.dv.setFloat32(u,r,this.isLittleEndian),this.dv.setFloat32(u+4,n,this.isLittleEndian),this.dv.setFloat32(u+8,a,this.isLittleEndian)}},{key:"init",value:function(){this.currentIndex=0}},{key:"resize",value:function(t){if(!(t<=this.totalByteLength)){var e=this.buffer;this.buffer=new ArrayBuffer(t);var i=new Uint8Array(e);new Uint8Array(this.buffer).set(i,0),this.dv=new DataView(this.buffer)}}},{key:"append",value:function(t){var e=this.currentIndex,i=t.totalByteLength;this.resize(i+e*s);var r=new Uint8Array(t.buffer);new Uint8Array(this.buffer).set(r,e*s),this.currentIndex+=t.currentIndex}},{key:"addFragmentData",value:function(t,e,i,r,n,a,s,l){var u=this.currentIndex;u*this.singleDataByteLength>=this.totalByteLength&&this.resize(2*this.totalByteLength),this.setFragmentData(t,e,i,r,n,a,s,l,u),this.currentIndex++}},{key:"totalByteLength",get:function(){return this.buffer.byteLength}},{key:"singleDataByteLength",get:function(){return s}}]),t}();e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),a=i(9),s=(r=a)&&r.__esModule?r:{default:r},l=4,u=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s.default),n(e,[{key:"setMatrixIndex",value:function(t,e){this.setData(t,e)}},{key:"addMatrixIndex",value:function(t){var e=this.currentIndex;e*this.singleDataByteLength>=this.totalByteLength&&this.resize(2*this.totalByteLength),this.setMatrixIndex(t,e),this.currentIndex++}},{key:"getMatrixIndex",value:function(t){return this.getData(t)}}]),e}();e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),s=i(28),l=(r=s)&&r.__esModule?r:{default:r},u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pageImages=[],this.fontImageMap={},this.fontMap={},this.loadCount=0}return a(t,[{key:"getBMFont",value:function(t){return this.fontMap[t.trim()]}},{key:"getFontImage",value:function(t,e){return this.fontImageMap[t.trim()][e]}},{key:"loadBMFont",value:function(t,e,i,r){r=r||{},t=t.replace(/\\/g,"/");var a="",s=t.lastIndexOf("/");-1!=s&&(a=t.slice(0,s),a+="/");var u=new XMLHttpRequest;u.open("GET",t,!0),u.responseType="text";var o=this;u.onload=function(t){if(200==u.status){var s=function(){var t=0,n=u.responseText,s=l.default.parseXML(n),h=s.pages.length;if(null==s){if(r.fail)return r.fail("can not parse xml fnt file,make sure it's xml type"),{v:void 0}}else!function(){var n=s.fontFamily.toLocaleLowerCase().trim();s.isBold&&(n+="_bold"),s.isItalic&&(n+="_italic"),o.fontMap[n]=s,o.fontImageMap[n]={},t=0;for(var l=0;l<s.pages.length;l++){var u=s.pages[l],f=new Image;f.pageId=u.id,f.onload=function(a){var s=a.target;o.fontImageMap[n][s.pageId]=s,e.registerImageData(s,i,!0),++t==h&&r.success&&r.success()},f.onerror=function(t){r.fail&&r.fail("cant load image",t)},f.src=a+u.file}}()}();if("object"===(void 0===s?"undefined":n(s)))return s.v}else r.fail&&r.fail(u.statusText)},u.send(null),r.complete&&r.complete()}},{key:"initDefaultFont",value:function(t,e){}}]),t}();e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"parseXML",value:function(t){var e=(new DOMParser).parseFromString(t,"text/xml");if(null==e.getElementsByTagName("font"))return null;var i={fontFamily:null,size:0,isBold:!1,isItalic:!1,charset:null,isUnicode:!1,stretchH:0,isSmooth:!1,aa:0,leftPadding:0,topPadding:0,rightPadding:0,bottomPadding:0,leftSpacing:0,rightSpacing:0,outline:0},r=e.getElementsByTagName("info");if(null==r||0==r.length)return null;var n=r[0];i.fontFamily=n.getAttribute("face"),i.size=Number.parseInt(n.getAttribute("size")),i.isBold=1==Number.parseInt(n.getAttribute("bold")),i.isItalic=1==Number.parseInt(n.getAttribute("italic")),i.charset=n.getAttribute("charset"),i.isUnicode=1==Number.parseInt(n.getAttribute("unicode")),i.stretchH=Number.parseInt(n.getAttribute("stretchH")),i.isSmooth=1==Number.parseInt(n.getAttribute("smooth")),i.aa=Number.parseInt(n.getAttribute("aa"));var a=n.getAttribute("padding").split(",");i.leftPadding=Number.parseInt(a[0]),i.rightPadding=Number.parseInt(a[1]),i.topPadding=Number.parseInt(a[2]),i.bottomPadding=Number.parseInt(a[3]);var s=n.getAttribute("spacing").split(",");i.leftSpacing=Number.parseInt(s[0]),i.rightSpacing=Number.parseInt(s[1]),i.outline=Number.parseInt(n.getAttribute("outline"));var l=e.getElementsByTagName("common");if(null==l||0==l.length)return null;var u=l[0],o={lineHeight:0,base:0,scaleW:0,scaleH:0,pages:0,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0};o.lineHeight=Number.parseInt(u.getAttribute("lineHeight")),o.base=Number.parseInt(u.getAttribute("base")),o.scaleW=Number.parseInt(u.getAttribute("scaleW")),o.scaleH=Number.parseInt(u.getAttribute("scaleH")),o.pages=Number.parseInt(u.getAttribute("pages")),o.alphaChnl=Number.parseInt(u.getAttribute("alphaChnl")),o.redChnl=Number.parseInt(u.getAttribute("redChnl")),o.greenChnl=Number.parseInt(u.getAttribute("greenChnl")),o.blueChnl=Number.parseInt(u.getAttribute("blueChnl")),i.common=o;var h=e.getElementsByTagName("pages");if(null==h||0==h.length)return null;var f=h[0];i.pages=[];for(var c=0;c<f.childNodes.length;c++){var d=f.childNodes[c];if(d.nodeType==Node.ELEMENT_NODE){var y={};y.file=d.getAttribute("file"),y.id=Number.parseInt(d.getAttribute("id")),i.pages.push(y)}}var g=e.getElementsByTagName("chars");if(null==g||0==g.length)return i;var v=g[0];i.charsCount=Number.parseInt(v.getAttribute("count")),i.chars=[];for(var p=0;p<v.childNodes.length;p++){var x=v.childNodes[p];if(x.nodeType!=Node.TEXT_NODE){var m={};m.id=Number.parseInt(x.getAttribute("id")),m.x=Number.parseInt(x.getAttribute("x")),m.y=Number.parseInt(x.getAttribute("y")),m.width=Number.parseInt(x.getAttribute("width")),m.height=Number.parseInt(x.getAttribute("height")),m.xoffset=Number.parseInt(x.getAttribute("xoffset")),m.yoffset=Number.parseInt(x.getAttribute("yoffset")),m.xadvance=Number.parseInt(x.getAttribute("xadvance")),m.page=Number.parseInt(x.getAttribute("page")),m.chnl=Number.parseInt(x.getAttribute("chnl")),i.chars[m.id]=m}}var b=e.getElementsByTagName("kernings");if(null==b||0==b.length)return i;var M=b[0];i.kerningsCount=Number.parseInt(M.getAttribute("count")),i.kernings=[];for(var w=0;w<M.childNodes.length;w++){var k=M.childNodes[w];if(k.nodeType!=Node.TEXT_NODE){var P={};P.first=Number.parseInt(k.getAttribute("first")),P.second=Number.parseInt(k.getAttribute("second")),P.amount=Number.parseInt(k.getAttribute("amount")),i.kernings.push(P)}}return i.kernings.sort(function(t,e){return t.first-e.first==0?t.second-e.second:t.first-e.first}),i}}]),t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=Symbol("当前顶点游标位置"),a=Symbol("Int16的typed数组"),s=Symbol("存储顶点数组的buffer"),l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this[s]=new ArrayBuffer(2*e),this[a]=new Uint16Array(this[s]),this[n]=0}return r(t,[{key:"init",value:function(){this[n]=0}},{key:"setIndex",value:function(t,e){2*e>=this.totalByteLength&&this.resize(2*this.totalByteLength),this[a][e]=t}},{key:"getIndex",value:function(t){return this[a][t]}},{key:"addIndex",value:function(t){var e=this[n];this.setIndex(t,e),this[n]++}},{key:"resize",value:function(t){if(!(t<=this.totalByteLength)){var e=this[s];this[s]=new ArrayBuffer(t);var i=new Uint8Array(e);new Uint8Array(this[s]).set(i,0),this[a]=new Uint16Array(this[s])}}},{key:"append",value:function(t){var e=this.currentIndex,i=t.totalByteLength;this.resize(i+2*e);var r=new Uint8Array(t.buffer);new Uint8Array(this.buffer).set(r,2*e),this[n]+=t.currentIndex}},{key:"dataArray",get:function(){return this[a]}},{key:"singleDataByteLength",get:function(){return 2}},{key:"totalByteLength",get:function(){return this[s].byteLength}},{key:"buffer",get:function(){return this[s]}},{key:"currentIndex",get:function(){return this[n]}}]),t}();e.default=l}]).default},function(t,e,i){t.exports=i(2)},function(t,e,i){"use strict";i.r(e);let r=Symbol("float32数组，3位");class n{constructor(t,e,i){this[r]=new Float32Array(3),null!=t&&(this[r][0]=t),null!=e&&(this[r][1]=e),null!=i&&(this[r][2]=i)}get x(){return this[r][0]}set x(t){this[r][0]=t}get y(){return this[r][1]}set y(t){this[r][1]=t}get z(){return this[r][2]}set z(t){this[r][2]=t}}let a=Symbol("List中的数据数组");class s{constructor(){this[a]=[]}get length(){return this[a].length}get size(){return this[a].length}get array(){return this[a]}exchangePosition(t,e){if(t==e)return;let i=this[a][t];this[a][t]=this[a][e],this[a][e]=i}set(t,e){t>=this.size||(this[a][t]=e)}isEmpty(){return 0==this.size}get(t){return this[a][t]}addAll(t){for(let e=0;e<t.length;e++){let i=null;null!=(i=t instanceof Array?t[e]:t.get(e))&&this.add(i)}}indexOf(t){for(var e=0;e<this.length;e++)if(this.get(e)==t)return e;return-1}add(t){this[a].push(t)}push(t){this[a].push(t)}pop(){this[a].pop()}insert(t,e){this[a].splice(e,0,t)}delete(t){t>=0&&t<this[a].length&&this[a].splice(t,1)}remove(t){for(var e=0;e<this.length;e++)if(this.get(e)==t){this[a].splice(e,1);break}}sort(t){function e(t,e,i){let r=t[e];t[e]=t[i],t[i]=r}for(let i=0;i<this[a].length;i++)for(let r=0;r<this[a].length-1-i;r++)t?t(this[a][r],this[a][r+1])&&e(this[a],r,r+1):this[a][r]>this[a][r+1]&&e(this[a],r,r+1)}contains(t){for(let e=0;e<this.length;e++){if(this.get(e)==t)return!0}return!1}clean(){this[a].length=0}}const l=1e-5,u=2*Math.PI,o=Math.PI/180;class h{static overlaps(t,e){let i=t,r=e;return i.left<=r.right&&i.right>=r.left&&i.bottom>=r.top&&i.top<=r.bottom}static get PIDIV180(){return o}static get PI2(){return u}static get EPSILON(){return l}static equals(t,e){return Math.abs(t-e)<=l}static clamp(t,e,i){return t>i?i:t<e?e:t}}i(0);let f=Symbol("figure对象的唯一标示"),c=Symbol("figure左上角坐标点以及大小的一个数组,0位是x,1位是y,2位是z,3位是width,4位是height"),d=Symbol("figure旋转拉伸所在锚点的计算方法"),y=Symbol("子figure列表"),g=Symbol("父figure"),v=Symbol("缩放数组,0位是x缩放，1位是y缩放，2位是z缩放"),p=Symbol("旋转角度数组,0位是x轴角度，1位是y轴角度，2位是z轴角度"),x=Symbol("figure的透明度,0 - 1"),m=Symbol("figure是否显示 , boolean值"),b=Symbol("figure事件map"),M=Symbol("默认转换锚点"),w=Symbol("Figure所在的区域"),k=Symbol("figure相对于自身的bounds"),P=Symbol("Figure内部绘制是否发生了改变"),S=Symbol("Figure坐标、旋转、伸缩是否发生了改变"),T=Symbol("figure自身的变换4x4矩阵"),_=Symbol("figure的中心位置"),I=0;const A="add_child",D="remove_child",C="before_draw_self",E="after_draw_self",R={name:null,figure:null,property:null};class V{constructor(t){t=t||{},this[f]=I++,this.autoIgnoreOutsizeChild=t.autoIgnore||!1,this[M]=new n,this[c]=new Float32Array(5),this[c][0]=t.x||0,this[c][1]=t.y||0,this[c][2]=t.z||0,this[c][3]=t.width||0,this[c][4]=t.height||0,this[v]=new n,this[v].x=t.scaleX||1,this[v].y=t.scaleY||1,this[v].z=t.scaleZ||1,this[p]=new n,this[p].x=t.rotateX||0,this[p].y=t.rotateY||0,this[p].z=t.rotate||0,this[x]=t.opacity||1,this.parent=null,this[b]=[],this[m]=t.visible||!0,this[d]=null,this[y]=new s,this[w]=[],this[k]={left:0,top:0,right:this.width,bottom:this.height},this.relativeBounds={left:0,top:0,right:this.width,bottom:this.height,width:0,height:0},this[T]=tielifa.Mat4.identity(),this.relativeMatrix=tielifa.Mat4.identity(),this[S]=!0,this[P]=!0,this[_]=new n,this._tempP1=new Float32Array(4),this._tempP2=new Float32Array(4),this._tempP3=new Float32Array(4),this._tempP4=new Float32Array(4)}static get EVENT_ADD_CHILD(){return A}static get EVENT_REMOVE_CHILD(){return D}static get EVENT_AFTER_DRAW_SELF(){return E}static get EVENT_BEFORE_DRAW_SELF(){return C}get center(){return this[_].x=this.width/2,this[_].y=this.height/2,this[_].z=this.depth/2,this[_]}get childrenSize(){return this[y].length}get parent(){return this[g]}set parent(t){this[g]=t}get relatedRegions(){return this[w]}set relatedRegions(t){this[w]=t}get isContentChanged(){return this[P]}fireContentChange(t){this[P]=t}get isTransformChanged(){return this[S]}fireTransformChange(t){this[S]=t}get transformAnchorCalculator(){return this[d]}set transformAnchorCalculator(t){this[d]=t}get opacity(){return this[x]}set opacity(t){h.equals(t,this[x])||(this[x]=t,this.fireContentChange(!0))}update(t){t.save(),this.beforeDraw(t),this.applyTransform(t),this.applyDrawingStyle(t),this.drawSelf(t),this.afterDraw(t),this.updateChildren(t),t.restore()}beforeDraw(t){R.name=C,R.figure=this,this.fireEvent(C,R)}afterDraw(t){R.name=E,R.figure=this,this.fireEvent(E,R)}get Id(){return this[f]}get right(){return this.left+this.width}get bottom(){return this.top+this.height}get x(){return this.left}set x(t){this.left=t}get y(){return this.top}set y(t){this.top=t}get z(){return this.depth}set z(t){this.depth=t}get left(){return this[c][0]}set left(t){h.equals(t,this[c][0])||(this[c][0]=t,this.fireTransformChange(!0))}get top(){return this[c][1]}set top(t){h.equals(t,this[c][1])||(this[c][1]=t,this.fireTransformChange(!0))}get depth(){return this[c][2]}set depth(t){h.equals(t,this[c][2])||(this[c][2]=t,this.fireTransformChange(!0))}get width(){return this[c][3]}set width(t){h.equals(t,this[c][3])||(this[c][3]=t,this.fireContentChange(!0))}get height(){return this[c][4]}set height(t){h.equals(t,this[c][4])||(this[c][4]=t,this.fireContentChange(!0))}get rotate(){return this[p].z}set rotateX(t){t%=360,h.equals(t,this[p].x)||(this[p].x=t,this.fireTransformChange(!0))}get rotateX(){return this[p].x}set rotateY(t){t%=360,h.equals(t,this[p].y)||(this[p].y=t,this.fireTransformChange(!0))}get rotateY(){return this[p].y}set rotate(t){t%=360,h.equals(t,this[p].z)||(this[p].z=t,this.fireTransformChange(!0))}get scaleX(){return this[v].x}get scaleY(){return this[v].y}get scaleZ(){return this[v].z}set scaleX(t){h.equals(t,this[v].x)||(this[v].x=t,this.fireTransformChange(!0))}set scaleY(t){h.equals(t,this[v].y)||(this[v].y=t,this.fireTransformChange(!0))}set scaleZ(t){h.equals(t,this[v].z)||(this[v].z=t,this.fireTransformChange(!0))}get children(){return this[y]}get visible(){return this[m]}set visible(t){this[m]=t}drawSelf(t){}applyTransform(t){let e=this.getTransformMatrix();t.applyTransformMatrix(e)}applyDrawingStyle(t){t.globalAlpha=this.opacity}updateChildren(t){for(let e=0;e<this.children.length;e++){let i=this.children.get(e);i.visible&&(this.autoIgnoreOutsizeChild&&this.isOutside(i)||i.update(t))}}getTransformAnchor(){return this.transformAnchorCalculator?this.transformAnchorCalculator(this):this.getDefaultTransformAnchor()}getDefaultTransformAnchor(){return this[M].x=this.width/2,this[M].y=this.height/2,this[M].z=this.depth/2,this[M]}addEventListener(t,e){null!=this[b][t]&&null!=this[b][t]||(this[b][t]=[]),this[b][t].push(e)}removeEventListener(t,e){null!=this[b][t]&&this[b][t].pop(e)}cleanEventListener(t){null!=this[b][t]&&null!=this[b][t]&&(this[b][t].length=0)}fireEvent(t,e){if(null!=this[b][t])for(let i=0;i<this[b][t].length;i++){let r=this[b][t][i];r&&r(e)}}indexOf(t){return this[y].indexOf(t)}getGraph(){let t=this.parent;return t?t.getGraph():this}getChild(t){return this[y].get(t)}containsChild(t){return this[y].contains(t)}insertChild(t,e){if(null==t)return;if(this.containsChild(t))return;let i=t.parent;return i&&i.removeChild(t),this[y].insert(t,e),t.parent=this,R.name=A,R.figure=this,R.property={oldparent:i,currentparent:this,child:t},this.fireEvent(A,R),t}addChild(t){if(null==t)return;if(this.containsChild(t))return;let e=t.parent;return e&&e.removeChild(t),this[y].add(t),t.parent=this,R.name=A,R.figure=this,R.property={oldparent:e,currentparent:this,child:t},this.fireEvent(A,R),t}getRelativeTransformMatrix(t){let e=this.getTransformMatrix();if(t==this.parent)return e;let i=this.relativeMatrix;return tielifa.Mat4.identityMatrix(i),null!=this.parent&&null!=this.parent&&tielifa.Mat4.copy(this.parent.getRelativeTransformMatrix(t),i),tielifa.Mat4.multiply(i,i,e),i}getTransformMatrix(){if(this.isTransformChanged){tielifa.Mat4.identityMatrix(this[T]);let t=this[T],e=tielifa.Mat4.TEMP_MAT4[0];tielifa.Mat4.identityMatrix(e);let i=this.left,r=this.top,n=this.depth,a=this.scaleX,s=this.scaleY,l=this.scaleZ,u=this.rotate,o=this.rotateX,f=this.rotateY;h.equals(i,0)&&h.equals(r,0)&&h.equals(n,0)||(tielifa.Mat4.translationMatrix(e,i,r,n),tielifa.Mat4.multiply(t,t,e));let c=this.getTransformAnchor(),d=c.x,y=c.y,g=c.z,v=!1;h.equals(d,0)&&h.equals(y,0)&&h.equals(g,0)||(v=!0),v&&(tielifa.Mat4.translationMatrix(e,d,y,g),tielifa.Mat4.multiply(t,t,e)),h.equals(u,0)||(tielifa.Mat4.rotationZMatrix(e,u*h.PIDIV180),tielifa.Mat4.multiply(t,t,e)),h.equals(o,0)||(tielifa.Mat4.rotationXMatrix(e,o*h.PIDIV180),tielifa.Mat4.multiply(t,t,e)),h.equals(f,0)||(tielifa.Mat4.rotationYMatrix(e,f*h.PIDIV180),tielifa.Mat4.multiply(t,t,e)),v&&(tielifa.Mat4.translationMatrix(e,-d,-y,-g),tielifa.Mat4.multiply(t,t,e)),h.equals(a,1)&&h.equals(s,1)&&h.equals(l,1)||(tielifa.Mat4.scalingMatrix(e,a,s,l),tielifa.Mat4.multiply(t,t,e));let p=d/a-d,x=y/s-y,m=g/l-g;h.equals(p,0)&&h.equals(x,0)&&h.equals(m,0)||(tielifa.Mat4.translationMatrix(e,p,x,m),tielifa.Mat4.multiply(t,t,e)),this.fireTransformChange(!1)}return this[T]}getRelativeBounds(t){let e=this.getRelativeTransformMatrix(t),i=this.width,r=this.height;this._tempP1[0]=0,this._tempP1[1]=0,this._tempP1[2]=this.depth,this._tempP1[3]=1,this._tempP2[0]=i,this._tempP2[1]=0,this._tempP2[2]=this.depth,this._tempP2[3]=1,this._tempP3[0]=0,this._tempP3[1]=r,this._tempP3[2]=this.depth,this._tempP3[3]=1,this._tempP4[0]=i,this._tempP4[1]=r,this._tempP4[2]=this.depth,this._tempP4[3]=1;let n=tielifa.Mat4.multiplyWithVertex(e,this._tempP1,this._tempP1),a=tielifa.Mat4.multiplyWithVertex(e,this._tempP2,this._tempP2),s=tielifa.Mat4.multiplyWithVertex(e,this._tempP3,this._tempP3),l=tielifa.Mat4.multiplyWithVertex(e,this._tempP4,this._tempP4),u=n;a[0]<u[0]&&(u=a),s[0]<u[0]&&(u=s),l[0]<u[0]&&(u=l);let o=n;a[1]<o[1]&&(o=a),s[1]<o[1]&&(o=s),l[1]<o[1]&&(o=l);let h=n;a[0]>h[0]&&(h=a),s[0]>h[0]&&(h=s),l[0]>h[0]&&(h=l);let f=n;return a[1]>f[1]&&(f=a),s[1]>f[1]&&(f=s),l[1]>f[1]&&(f=l),this.relativeBounds.left=u[0],this.relativeBounds.top=o[1],this.relativeBounds.right=h[0],this.relativeBounds.bottom=f[1],this.relativeBounds.width=h[0]-u[0],this.relativeBounds.height=f[1]-o[1],this.relativeBounds}get absoluteRotate(){let t=this.rotate,e=this.parent;for(;null!=e;)t+=e.rotate,e=e.parent;return t}getSelectBounds(){return this.getRelativeBounds(this.getGraph())}isOutside(t){this[k].right=this.width,this[k].bottom=this.height;let e=t.getRelativeBounds(this);return!h.overlaps(this[k],e)}moveFigureToTop(t){if(this.containsChild(t)){let e=this.indexOf(t),i=this.childrenSize-1;this[y].exchangePosition(e,i)}}removeChild(t){if(null!=t)return this[y].remove(t),t.parent=null,R.name=D,R.figure=this,R.property={oldparent:this,currentparent:null,child:t},this.fireEvent(D,R),t}}class O{get isRunning(){return this._isRunning}constructor(t,e){this.debug=!1,this.repeat=t,this.stopcallback=e,this.threadId=null,this.stopped=!0,this.refreshCount=0,this._isRunning=!1}loop(t){this.stopped||(this.debug&&console.log(this.threadId+" 正在运行"),null!=this.repeat&&null!=this.repeat&&this.repeat(t),this.threadId=null,this.stopped||this.start())}setRepeatFunction(t){this.repeat=t}pause(){let t=this.refreshCount;this.stop(),this.refreshCount=t}start(){if(null==this.threadId){let t=this;this._isRunning=!0,this.stopped=!1,this.threadId=requestAnimationFrame(function(){t.refreshCount++,t.loop(t.refreshCount)}),this.debug&&console.log(this.threadId+" 就绪")}}stop(){this.debug&&console.log(this.threadId+" 停止"),this.stopped=!0,cancelAnimationFrame(this.threadId),this.threadId=null,this._isRunning=!1,this.stopcallback&&this.stopcallback(this.refreshCount),this.refreshCount=0}}let N=Symbol("暂停循环刷新是否已暂停");class L extends V{constructor(t,e){super(e),this.x=0,this.y=0,this.z=0,this.width=t.width,this.height=t.height,this.ctx=new tielifa.WebGL2D(t,e),this.canvas=t,this.loopInterface=null,this._loop=new O;let i=this;this._loop.repeat=function(t){i.loopRefresh(t)},this[N]=!1}loadImage(t,e,i,r){this.ctx.loadImage(t,e,i,r)}getTexture(t,e){return this.ctx.getTexture(t,e)}get paused(){return this[N]}update(){this.clean(),super.update(this.ctx),this.ctx.draw()}get parent(){return null}set parent(t){}clean(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawSelf(t){}loopRefresh(){this.loopInterface&&this.loopInterface.loopStart&&this.loopInterface.loopStart(),this.paused||(this.update(),this.loopInterface&&this.loopInterface.loopEnd&&this.loopInterface.loopEnd())}pause(){this[N]=!0}startLoopRefresh(t){this.paused?this[N]=!1:(this.loopInterface=t,this._loop.start())}stopLoopRefresh(){this._loop.stop()}}class F extends V{constructor(t){super(t=t||{}),this.color=t.color||"black",this.borderColor=t.borderColor,this.borderWidth=t.borderWidth||0}applyDrawingStyle(t){super.applyDrawingStyle(t),t.fillStyle=this.color,this.borderColor&&(t.strokeStyle=this.borderColor),t.lineWidth=this.borderWidth}drawSelf(t){t.beginPath(),this.defineShapePath(t),t.closePath(),t.fill(),this.borderColor&&t.stroke()}defineShapePath(t){}}class B extends F{constructor(t){super(t=t||{}),this.radiusX=t.radiusX||0,this.radiusY=t.radiusY||0,this.centerX=t.centerX||0,this.centerY=t.centerY||0}get centerX(){return this.left+this.radiusX}set centerX(t){this.left=t-this.radiusX}get centerY(){return this.top+this.radiusY}set centerY(t){this.top=t-this.radiusY}get radiusX(){return this.width/2}set radiusX(t){this.width=2*t}get radiusY(){return this.height/2}set radiusY(t){this.height=2*t}get width(){return super.width}get height(){return super.height}set width(t){super.width=t}set height(t){super.height=t}defineShapePath(t){t.ellipse(this.radiusX,this.radiusY,this.radiusX,this.radiusY,0,0,2*Math.PI)}}const z=.001;class j{constructor(){}static collisionTest(t,e){let i={collision:!1,minOverlapFigure:void 0,minOverlapAxisIndex:-1,MTV:{minOverlap:void 0,direction:void 0}},r=t.vertices,n=e.vertices;i.centerA=t.center,i.centerB=e.center,i.verticesA=t.vertices,i.verticesB=e.vertices;let a=t.axis,s={figure:void 0,min:0,max:0,minVertex:void 0,maxVertex:void 0},l={figure:void 0,min:0,max:0,minVertex:void 0,maxVertex:void 0};s.figure=t,l.figure=e;let u=void 0,o=void 0,f=-1;for(let e=0;e<a.length;e++){let h=a[e];this.projectionToAxis(s,r,h),this.projectionToAxis(l,n,h);let c=this.getMinOverlap(void 0,s,l);if(null==u?(u=c,o=t,f=e):c.value<u.value&&(u=c,o=t,f=e),u.value<=0)return i.collision=!1,i}let c,d=e.axis;for(let t=0;t<d.length;t++){let a=d[t];this.projectionToAxis(s,r,a),this.projectionToAxis(l,n,a);let h=this.getMinOverlap(void 0,s,l);if(h.value<u.value&&(u=h,o=e,f=t),u.value<=0)return i.collision=!1,i}u.value=Math.ceil(1e3*u.value)/1e3,i.collision=!0,i.MTV.minOverlap=u;let y,g,v={p1:void 0,p2:void 0,p3:void 0,p4:void 0};c=o==t?a[f]:d[f],y=u.max.figure==t?M(u.max.vertex,r,c):M(u.max.vertex,n,c),g=u.min.figure==t?M(u.min.vertex,r,c):M(u.min.vertex,n,c),y.p3=g.p1,y.p4=g.p2,null==y.p2?(v.p1=y.p3,v.p2=y.p4):(v.p1=y.p1,v.p2=y.p2),null!=g.p4&&(v.p3=y.p3,v.p4=y.p4);for(let i in v){let n=v[i];null!=n&&(n.vertices==r?n.figure=t:n.figure=e)}let p=[],x=y.p1,m=y.p1,b={x:c.y,y:c.x};for(let t in y){let e=y[t],i=x.vertices[x.index],r=m.vertices[m.index];if(e){let t=e.vertices[e.index],n=tielifa.Vector2.dot(i,b),a=tielifa.Vector2.dot(r,b),s=tielifa.Vector2.dot(t,b);s>n&&(x=e),s<a&&(m=e)}}for(let t in y){let e=y[t];e!=x&&e!=m&&(null!=e&&p.push(e))}function M(t,e,i){let r=e[t],n=(t-1+e.length)%e.length,a=(t+1+e.length)%e.length,s=e[n],l=e[a],u=new tielifa.Vector2(l.x-r.x,l.y-r.y);tielifa.Vector2.normalize(u,u);let o=new tielifa.Vector2(r.x-s.x,r.y-s.y);tielifa.Vector2.normalize(o,o);let f=Math.abs(tielifa.Vector2.dot(u,i)),c=Math.abs(tielifa.Vector2.dot(o,i));return f>=c?h.equals(c,0)||Math.abs(c)<=z?{p1:{index:n,vertices:e},p2:{index:t,vertices:e}}:{p1:{index:t,vertices:e},p2:null}:c>=f?h.equals(f,0)||Math.abs(c)<=z?{p1:{index:t,vertices:e},p2:{index:a,vertices:e}}:{p1:{index:t,vertices:e},p2:null}:void 0}return i.p1=p[0].vertices[p[0].index],p[0].vertices==r?p[0].figure=t:p[0].figure=e,2==p.length&&(i.p2=p[1].vertices[p[1].index],p[1].vertices==r?p[1].figure=t:p[1].figure=e),i.contactPoints=p,i.MTV.direction=c,i.minOverlapAxisIndex=f,i.contactPlane=v,i}static getMinOverlap(t,e,i){null==t&&(t={max:{},min:{}});let r=e.max-i.min,n=i.max-e.min,a=t;return r<n?(a.value=r,a.max.figure=e.figure,a.max.vertex=e.maxVertex,a.min.figure=i.figure,a.min.vertex=i.minVertex):(a.value=n,a.max.figure=i.figure,a.max.vertex=i.maxVertex,a.min.figure=e.figure,a.min.vertex=e.minVertex),t}static projectionToAxis(t,e,i){let r=tielifa.Vector2.dot(e[0],i),n=0,a=r,s=n;for(let t=1;t<e.length;t++){let l=tielifa.Vector2.dot(e[t],i);l>a&&(a=l,s=t),l<r&&(r=l,n=t)}t.min=r,t.minVertex=n,t.max=a,t.maxVertex=s}}class G{constructor(){}static getAxis(t,e,i){let r=[];null==i&&(i=!0),null==e&&(e=[]);for(let a=0;a<t.length;a++){let s=t[a],l=t[(a+1)%t.length],u=new tielifa.Vector2(l.y-s.y,s.x-l.x),o=Math.atan2(u.y,u.x);i&&n(r,o)||(r.push(o),tielifa.Vector2.normalize(u,u),e.push(u))}function n(t,e){for(let i=0;i<t.length;i++)if(h.equals(e,t[i]))return!0;return!1}return r=null,e}}const U=0,W=1,q=[0,0,1];class Y{constructor(t){t=t||{},this.type=t.type||U,this.axis=[],this.vertices=null,this.center=null,this.radiusX=null,this.radiusY=null,this.originalVertices=[],this.originalAxis=[],this.originalCenter=null,this.center=null,this._mass=1,this.inertia}get mass(){return this._mass}set mass(t){this._mass=t}get momentInertia(){if(this.mass==1/0)return 1/0;if(null==this.inertia){let t=0,e=0,i=this.vertices;for(let r=0;r<i.length;r++){let n=(r+1)%i.length,a=Math.abs(tielifa.Vector2.cross(i[n],i[r]));t+=a*(tielifa.Vector2.dot(i[n],i[n])+tielifa.Vector2.dot(i[n],i[r])+tielifa.Vector2.dot(i[r],i[r])),e+=a}if(0==e)return 1;this.inertia=this.mass/6*(t/e)}return this.inertia}static createDefaultModel(t){let e=new Y({type:0}),i=[];return i.push({x:0,y:0}),i.push({x:t.width,y:0}),i.push({x:t.width,y:t.height}),i.push({x:0,y:t.height}),e.generateModel(i,t.center,t.mass),e}generateModel(t,e,i){if(t instanceof Array){this.type=U,this.vertices=t,G.getAxis(this.vertices,this.axis);for(let t=0;t<this.vertices.length;t++){let e=this.vertices[t];this.originalVertices.push({x:e.x,y:e.y})}for(let t=0;t<this.axis.length;t++){let e=this.axis[t];this.originalAxis.push(new tielifa.Vector2(e.x,e.y))}this.center={x:e.x,y:e.y},this.originalCenter={x:e.x,y:e.y}}else this.type=W,this.center={x:e.x,y:e.y},this.originalCenter={x:e.x,y:e.y},this.radiusX=t.radiusX,this.radiusY=t.radiusY;this.mass=i,this.momentInertia}applyCurrentTransform(t,e){let i=tielifa.Mat3.TEMP_MAT3[0];if(i[0]=e[0],i[1]=e[1],i[2]=0,i[3]=e[4],i[4]=e[5],i[5]=0,i[6]=e[12],i[7]=e[13],i[8]=1,!Math.abs(t)<1e-7)for(let e=0;e<this.axis.length;e++){let i=this.axis[e],r=this.originalAxis[e];tielifa.Vector2.rotate(i,r,t*h.PIDIV180)}let r=q;for(let t=0;t<this.originalVertices.length;t++){let e=this.originalVertices[t];tielifa.Mat3.multiplyWithVertex(r,i,[e.x,e.y,1]),this.vertices[t].x=r[0],this.vertices[t].y=r[1]}tielifa.Mat3.multiplyWithVertex(r,i,[this.originalCenter.x,this.originalCenter.y,1]),this.center.x=r[0],this.center.y=r[1]}}let X=Symbol("坐标值");class H{get x(){return this[X][0]}set x(t){this[X][0]=t}get y(){return this[X][1]}set y(t){this[X][1]=t}constructor(t,e){this[X]=new Float32Array(2),this.x=t,this.y=e}clone(){return new H(this.x,this.y)}}let Z=Symbol("速度"),J=Symbol("角速度"),K=Symbol("受力"),$=Symbol("受力位置"),Q=Symbol("质量"),tt=Symbol("加速度"),et=Symbol("x轴休眠"),it=Symbol("y轴休眠"),rt=Symbol("旋转休眠"),nt=Symbol("质心"),at=Symbol("转动惯量"),st=Symbol("前一时刻的速度"),lt=Symbol("前一时刻的角速度"),ut=Symbol("前一时间的位置"),ot=Symbol("前一时刻的旋转度数"),ht=Symbol("figure的物理模型"),ft=Symbol("是否可碰撞，true则会进行碰撞测试，反之不会"),ct=Symbol("是否运动，如果为false则不会根据其速度重新计算位置"),dt=Symbol("暂停运动");const yt=1,gt=180/Math.PI,vt=(Math.PI,"beforeCalculatePose"),pt="afterCalculatePose",xt={name:null,figure:null};class mt extends V{constructor(t){super(t=t||{}),this[ft]=!0,this[st]=new tielifa.Vector2(0,0),this[ut]=new H(0,0),this[lt]=0,this[Q]=t.mass||1,this[Z]=t.velocity||new tielifa.Vector2(0,0),this[K]=t.force||new tielifa.Vector2(0,0),this[J]=t.angularVelocity||0,this[tt]=new tielifa.Vector2(0,0),this[et]=!1,this[it]=!1,this[at]=void 0,this.filter=t.filter||tielifa.WebGL2D.Normal_Filter,this[ct]=!1,this[nt]=t.massCenter,this[dt]=!1}static get EVENT_BEFORE_CALCULATE_POSE(){return vt}static get AFTER_BEFORE_CALCULATE_POSE(){return pt}get contactable(){return this[ft]}set contactable(t){this[ft]=t}get physicsModel(){return this[ht]}static get DELTA_TIME(){return yt}get forcePosition(){return null==this[$]&&(this[$]=new H(this.width/2,this.height/2)),this[$]}set forcePosition(t){this.forcePosition.x=t.x,this.forcePosition.y=t.y}overlap(t){let e=this.getSelectBounds(),i=t.getSelectBounds();return h.overlaps(e,i)}get isStaticFigure(){return this.mass==1/0}get inverseInertia(){return this.mass==1/0?0:1/this.momentInertia}get momentInertia(){return this.mass==1/0?1/0:null==this[ht]?(null==this[at]&&(this[at]=this[Q]*(this.width*this.width+this.height*this.height)/12),this[at]):this[ht].momentInertia}get isSleeping(){return 0==this.velocity.x&&0==this.velocity.y&&0==this.angularVelocity}get sleepX(){return this[et]}get sleepY(){return this[it]}get inverseMass(){return this.mass==1/0?0:1/this.mass}get mass(){return this[Q]}get massCenter(){return null==this[nt]&&(this[nt]=new H(this.center.x,this.center.y)),this[nt]}set massCenter(t){this[nt].x=t.x,this[nt].y=t.y}set mass(t){this[Q]=t}get angularVelocity(){return this[J]}set angularVelocity(t){this[J]=t}get speed(){return this.velocity.magnitude}get velocity(){return this[Z]}set velocity(t){this[Z].x=t.x,this[Z].y=t.y}get force(){return this[K]}set force(t){this[K].x=t.x,this[K].y=t.y}get acceleration(){return this[tt].x=this.force.x*this.inverseMass,this[tt].y=this.force.y*this.inverseMass,this[tt]}get angularAcceleration(){return this.torque*this.inverseInertia}get nextFrameVelocity(){}get preRotate(){return this[ot]}get preVelocity(){return this[st]}get prePosition(){return this[ut]}get preAngularVelocity(){return this[lt]}get torque(){return(this.forcePosition.x-this.massCenter.x)*this.force.x-(this.forcePosition.y-this.massCenter.y)*this.force.y}applyDrawingStyle(t){super.applyDrawingStyle(t),t.filterType=this.filter}backToPre(){this.left=this.prePosition.x,this.top=this.prePosition.y,this.rotate=this.preRotate,this.velocity.x=this.preVelocity.x,this.velocity.y=this.preVelocity.y,this.angularVelocity=this.preAngularVelocity}beforeDraw(t){super.beforeDraw(t),this[ct]&&!this.paused&&this.calculateCurrentPose()}calculateCurrentPose(){xt.figure=this,xt.name=vt,this.fireEvent(vt,xt);let t=this.acceleration,e=this.angularAcceleration;this[st].x=this.velocity.x,this[st].x=this.velocity.y;let i=this.velocity.x+t.x*yt,r=this.velocity.y+t.y*yt,n=!1,a=!1;(i*this.velocity.x<0||Math.abs(i+this.velocity.x)<=h.EPSILON)&&(n=!0),(r*this.velocity.y<0||Math.abs(r+this.velocity.y)<=h.EPSILON)&&(a=!0),this.velocity.x=i,this.velocity.y=r,this[ut].x=this.left,this[ut].y=this.top,this.left+=this.velocity.x*yt,this.top+=this.velocity.y*yt,this[lt]=this.angularVelocity;let s=e*yt+this.angularVelocity,l=!1;(s*this.angularVelocity<0||Math.abs(s+this.angularVelocity)<=h.EPSILON/1e3)&&(l=!0),this.angularVelocity=s,this[ot]=this.rotate,this.rotate+=this.angularVelocity*yt*gt;l&&!this[rt]&&(this.fireEvent("sleepRotate",{source:this}),this[rt]=!0),n&&!this[et]&&(this.fireEvent("sleepX",{source:this}),this[et]=!0),a&&!this[it]&&(this.fireEvent("sleepY",{source:this}),this[it]=!0),xt.name=pt,this.fireEvent(pt,xt)}set physicsModel(t){this[ht]=t}get physicsModel(){return this[ht]}startMove(){if(this.paused)return void(this[dt]=!1);this[et]=!1,this[it]=!1,this[rt]=!1,this[ct]=!0,this[dt]=!1;let t=this.getGraph();null!=t&&(t.monitorSpiritBeforeMove&&this.addEventListener(vt,t.monitorSpiritBeforeMove),t.monitorSpiritAfterMove&&this.addEventListener(pt,t.monitorSpiritAfterMove))}get paused(){return this[dt]}pauseMove(){this[dt]=!0}stopMove(){this[et]=!0,this[it]=!0,this[rt]=!0,this[ct]=!1,this[Z].x=this[Z].y=0,this[J]=0,this[K].x=this[K].y=0,this[dt]=!1;let t=this.getGraph();null!=t&&(t.monitorSpiritBeforeMove&&this.removeEventListener(vt,t.monitorSpiritBeforeMove),t.monitorSpiritAfterMove&&this.removeEventListener(pt,t.monitorSpiritAfterMove))}}class bt{constructor(t,e,i,r){this.left=t,this.top=e,this.right=i,this.bottom=r,this.relatedFigures=new s,this.id=-1}addFigure(t){this.relatedFigures.add(t)}removeFigure(t){this.relatedFigures.remove(t)}}class Mt{constructor(t,e,i,r){let n=Math.floor(i/e);i%e!=0&&e++;let a=Math.floor(r/t);r%t!=0&&t++,this.row=t,this.column=e,this.regions=new Array(t);for(let i=0;i<t;i++)this.regions[i]=new Array(e);let s=0;for(let i=0;i<t;i++){let t=i*a,r=t+a;for(let a=0;a<e;a++){let e=a*n,l=new bt(e,t,e+n,r);l.id=s,this.regions[i][a]=l,s++}}this.regionWidth=n,this.regionHeight=a}calculateRegionIndex(t,e){let i=Math.floor(t/this.regionWidth);return{row:Math.floor(e/this.regionHeight),column:i}}calculateRegionId(t){return t.row*this.column+t.column}findRegionId(t,e){let i=this.calculateRegionIndex(t,e);return this.getRegionId(i)}getRegion(t){let e=Math.floor(t/this.column);if(null!=this.regions[e]){let i=t-e*this.column;return this.regions[e][i]}}getRegionId(t){if(t.row>=0&&t.row<this.row&&t.column>=0&&t.column<this.column){return this.regions[t.row][t.column].id}}getRegions(t,e,i,r){let n=i;null==n?n=[]:n.length=0;let a=t.row,s=t.column,l=e.row-a+1,u=e.column-s+1;for(let t=0;t<l;t++)for(let e=0;e<u;e++){let i=this.getRegionId({row:t+a,column:e+s});if(null!=i){let t=this.getRegion(i);null!=r&&t.addFigure(r),n.push(i)}}return n}updateRegionsOfFigure(t){let e=t.getSelectBounds(),i=this.calculateRegionIndex(e.left,e.top),r=this.calculateRegionId(i),n=this.calculateRegionIndex(e.right,e.bottom),a=this.calculateRegionId(n),s=t.relatedRegions;if(0!=s.length){let t=s[0],e=s[s.length-1];if(t==r&&e==a)return}for(let e=0;e<t.relatedRegions.length;e++){let i=t.relatedRegions[e];this.getRegion(i).removeFigure(t)}t.relatedRegions.length=0,this.getRegions(i,n,t.relatedRegions,t)}test(){console.log(this.regions)}}let wt=100,kt=1e-5;class Pt{static get impulseIterateCount(){return wt}static set impulseIterateCount(t){wt=t}static get minImpulseValue(){return kt}static set minImpulseValue(t){kt=t}static solveCollision(t,e,i,r,n,a,s,l,u,o,f){function c(t,e,i,r){null==r&&(r=1),t.velocity.x+=r*e.x,t.velocity.y+=r*e.y,t.angularVelocity+=r*i,h.equals(t.velocity.x,0)&&(t.velocity.x=0),h.equals(t.velocity.y,0)&&(t.velocity.y=0),Math.abs(t.angularVelocity)<1e-4&&(t.angularVelocity=0)}let d=this.updateCollisionDirectionAndContacts(t,e,i,r,s,l,u,f),y=void 0;for(let n=0;n<wt;n++){let n=this.collisionResponse(t.velocity,e.velocity,t.angularVelocity,e.angularVelocity,t.inverseMass,e.inverseMass,t.inverseInertia,e.inverseInertia,i,r,d,u,o,f);if(c(t,n.v1,n.w1),c(e,n.v2,n.w2,-1),g(y=n.im))break}function g(t){for(let e in t){let i=t[e];if(!(0==i||i<kt))return!1}return!0}}static collisionResponse(t,e,i,r,n,a,s,l,u,o,f,c,d,y){null==d&&(d=1);let g={x:0,y:0},v={x:0,y:0},p=0,x=0,m=1;f instanceof Array&&(m=f.length);let b=new tielifa.Vector2(c.y,c.x),M={};for(let y=0;y<m;y++){let m=f[y];null==m&&(m=f);let w=new tielifa.Vector2(m.x-u.x,m.y-u.y),k=new tielifa.Vector2(m.x-o.x,m.y-o.y),P=this.calculateCurrentContactImpulse(t,e,i,r,n,a,s,l,w,k,c,d,f.length),S=P.jn,T=P.jt;null==m.normalImpulseSum&&(m.normalImpulseSum=0),null==m.tangentImpulseSum&&(m.tangentImpulseSum=0);let _=m.normalImpulseSum;m.normalImpulseSum=Math.max(m.normalImpulseSum+S,0),S=m.normalImpulseSum-_,_=m.tangentImpulseSum,m.tangentImpulseSum=h.clamp(m.tangentImpulseSum+T,-1*m.normalImpulseSum,m.normalImpulseSum),T=m.tangentImpulseSum-_;let I={x:0,y:0};tielifa.Vector2.multiplyValue(I,c,S*n),g.x=I.x,g.y=I.y,tielifa.Vector2.multiplyValue(I,b,T*n),g.x+=I.x,g.y+=I.y,tielifa.Vector2.multiplyValue(I,c,S*a),v.x=I.x,v.y=I.y,tielifa.Vector2.multiplyValue(I,b,T*a),v.x+=I.x,v.y+=I.y,p+=tielifa.Vector2.cross(w,c)*(s*S),p+=tielifa.Vector2.cross(w,b)*(s*T),x+=tielifa.Vector2.cross(k,c)*(l*S),x+=tielifa.Vector2.cross(k,b)*(l*T),M["impulse"+y]=S}return{v1:g,v2:v,w1:p,w2:x,im:M}}static calculateCurrentContactImpulse(t,e,i,r,n,a,s,l,u,o,f,c,d){let y=new tielifa.Vector2(f.y,f.x),g={x:0,y:0};g.x=-i*u.y,g.y=i*u.x;let v=g.x+t.x,p=g.y+t.y;g.x=-r*o.y,g.y=r*o.x,g.x=g.x+e.x,g.y=g.y+e.y,g.x=v-g.x,g.y=p-g.y;let x=tielifa.Vector2.dot(g,y);x*=-1;let m=-1-c;g.x*=m,g.y*=m;let b=tielifa.Vector2.dot(g,f),M=0,w=0;0!=s&&(M=(M=tielifa.Vector2.cross(u,f))*M*s,w=(w=tielifa.Vector2.cross(u,y))*w*s);let k=0,P=0;0!=l&&(k=(k=tielifa.Vector2.cross(o,f))*k*l,P=(P=tielifa.Vector2.cross(o,y))*P*l);let S=a+n,T=b/((M+k+S)*d),_=x/((w+P+S)*d),I=1*(T=Math.max(T,0));return{jn:T,jt:_=h.clamp(_,-1*I,I)}}static updateCollisionDirectionAndContacts(t,e,i,r,n,a,s,l){let u=s,o={x:u.x,y:u.y},h={x:r.x-i.x,y:r.y-i.y};tielifa.Vector2.dot(h,o)>0&&(o.x*=-1,o.y*=-1,u.x*=-1,u.y*=-1),tielifa.Vector2.multiplyValue(o,o,l),t.left+=o.x,t.top+=o.y,i.x+=o.x,i.y+=o.y;let f,c=[],d=n[0].vertices[n[0].index];return n[0].figure==t.physicsModel&&(d.x+=o.x,d.y+=o.y),c.push(d),null!=n[1]&&(f=n[1].vertices[n[1].index],c.push(f),n[1].figure==t.physicsModel&&(f.x+=o.x,f.y+=o.y)),c}}let St=Symbol("动画延迟开始的时间值"),Tt=Symbol("动画循环次数"),_t=Symbol("xunhuancishu temp"),It=Symbol("动画的总时长,单位毫秒");const At="complete",Dt="interrupt",Ct=.06;class Et{get isRunning(){return this._startRun}get loop(){return this[Tt]}set loop(t){this[Tt]=t,this[_t]=t}get delay(){return this[St]}set delay(t){this[St]=t}get totalTime(){return this[It]}set totalTime(t){this[It]=t}static get EASE(){return Nt}static get EASE_OUT(){return Ot}static get EASE_IN_OUT(){return Rt}static get EASE_OUT_IN(){return Vt}static get LINEAR(){return Lt}constructor(t,e,i,r){if(this.id=(new Date).getTime().toString()+Math.floor(100*Math.random()),!t)throw Error("动画主体figure不能为空");this.figure=t,this.type=i||Lt,this[It]=e||500,this.finalValues=[],this.originalValues=[],this.applyProperties=[],this._startRun=!1,this.preAnimation=void 0,this.nextAnimation=void 0;let n=this;this.loopFunction=function(t){n._startRun&&(n.repeat(),n.refreshCount++)},this._paused=!1,this[Tt]=0,this[_t]=void 0,this.callbacks=r,this.refreshCount=0}get paused(){let t=this;for(;t;){if(t._paused)return!0;t=t.preAnimation}let e=this;for(;e;){if(e._paused)return!0;e=e.nextAnimation}return!1}recordFigureValues(t,e,i){if(this.finalValues[i]=t,this.preAnimation){var r=this.preAnimation.finalValues[i];this.originalValues[i]=r||e}else this.originalValues[i]=e;this.applyProperties.push(i)}moveTo(t,e){return this.recordFigureValues(t,this.figure.left,"left"),this.recordFigureValues(e,this.figure.top,"top"),this}scaleTo(t,e){return this.recordFigureValues(t,this.figure.scaleX,"scaleX"),this.recordFigureValues(e,this.figure.scaleY,"scaleY"),this}propertyChangeTo(t,e){return this.recordFigureValues(t,this.figure[e],e),this}rotateTo(t){return this.recordFigureValues(t,this.figure.rotate,"rotate"),this}applyOriginalValue(){for(var t=0;t<this.applyProperties.length;t++){var e=this.applyProperties[t];this.figure[e]=this.originalValues[e]}}applyDeltaValue(t){for(var e=0;e<this.applyProperties.length;e++){var i=this.applyProperties[e];this.figure[i]+=t[i]}}applyFigureChange(t){for(var e=0;e<this.applyProperties.length;e++){var i=this.applyProperties[e],r=this.originalValues[i],n=this.calculateDeltaValue(t,i);this.figure[i]=r+n}}applyFinalValue(){for(var t=0;t<this.applyProperties.length;t++){var e=this.applyProperties[t];this.figure[e]=this.finalValues[e]}}then(t,e){return this.nextAnimation=new Et(this.figure,t,e),this.nextAnimation.loop=this.loop,this.nextAnimation.preAnimation=this,this.nextAnimation}calculateDeltaValue(t,e){var i=this.originalValues[e],r=this.finalValues[e]-i;if(0==r)return 0;let n=Math.floor(this.totalTime*Ct);var a=this.type,s=!1;if(a==Rt||a==Vt){r/=2,n/=2,(a=Nt)==Vt&&(a=Ot);var l=this.figure[e];Math.abs(l-i)>=Math.abs(r)&&((a=Ot)==Vt&&(a=Nt),s=!0,t-=n)}a==Lt&&(u=(o=r/n)*t);if(a==Nt)var u=r*t*t/(n*n);if(a==Ot){var o;u=(o=2*r/(n*n))*n*t-o*t*t/2}return s&&(u+=r),u}reachFinalFrame(t){if(t>=Math.floor(this.totalTime*Ct))return!0;for(var e=!0,i=0;i<this.applyProperties.length;i++){var r=this.applyProperties[i],n=this.finalValues[r]-this.originalValues[r];n>0&&(this.figure[r]>=this.finalValues[r]||(e=!1)),n<0&&(this.figure[r]<=this.finalValues[r]||(e=!1))}return e}cleanAnimationData(){this.finalValues.length=0,this.originalValues.length=0,this.applyProperties.length=0,this[Tt]=0}repeat(){this.applyFigureChange(this.refreshCount),this.reachFinalFrame(this.refreshCount)&&(this.applyFinalValue(),this.complete(),this.nextAnimation&&this.nextAnimation.launchImmediately())}complete(){this.stop(At)}interrupt(){this.stop(Dt)}stop(t){if((t=t||Dt)===Dt){let t=this;for(;t;)t.applyOriginalValue(),this.figure.removeEventListener(V.EVENT_BEFORE_DRAW_SELF,t.loopFunction),t=t.preAnimation;let e=this.nextAnimation;for(;e;)this.figure.removeEventListener(V.EVENT_BEFORE_DRAW_SELF,e.loopFunction),e=e.nextAnimation;return}this._startRun=!1,this.refreshCount=0,this.loop>0&&this.loop--;let e=this.preAnimation;if(e)for(;null!=e.preAnimation;)e=e.preAnimation;else e=this;if(0===this.loop)this.cleanAnimationData(),this.figure.removeEventListener(V.EVENT_BEFORE_DRAW_SELF,this.loopFunction),this.callbacks&&(t===Dt?this.callbacks.stop&&this.callbacks.stop():t===At&&this.callbacks.complete&&this.callbacks.complete());else{if(this.nextAnimation)return void this.nextAnimation.launchImmediately();if(this.preAnimation){let t=this;for(;t!==e;)t.applyOriginalValue(),t=t.preAnimation;return void e.launchImmediately()}this.launchImmediately()}}setRunningAnimationOnChainPause(t){if(t&&this.isRunning)return this._startRun=!t,void(this._paused=t);if(!t&&this._paused)return this._startRun=!t,void(this._paused=t);let e=this.preAnimation;for(;e;)t&&e.isRunning&&(e._startRun=!t,e._paused=t),!t&&e._paused&&(e._startRun=!t,e._paused=t),e=e.preAnimation;let i=this.nextAnimation;for(;i;)t&&i.isRunning&&(i._startRun=!t,i._paused=t),!t&&i._paused&&(i._startRun=!t,i._paused=t),i=i.nextAnimation}pause(){this.setRunningAnimationOnChainPause(!0)}start(t){this.paused?this.setRunningAnimationOnChainPause(!1):(this.figure.addEventListener(V.EVENT_BEFORE_DRAW_SELF,this.loopFunction),t&&(this.callbacks=t),this.preAnimation?this.preAnimation.start():(this.applyOriginalValue(),this.launchImmediately()))}launchImmediately(){let t=this;null!=this.delay?setTimeout(function(){t.refreshCount=0,this._startRun=!0},this.delay):(this.refreshCount=0,this._startRun=!0)}}const Rt="ease_in_out",Vt="ease_out_in",Ot="ease_out",Nt="ease",Lt="linear";let Ft={};!function t(e,i){for(let r in e){let n=e[r],a=n;"object"==typeof a&&t(n,a={}),Object.defineProperty(i,r,{get:function(){return a}})}}({version:"0.0.1",Graph:L,shape:{Ellipse:B,Circle:class extends B{constructor(t){super(t=t||{}),this.radius=t.radius||0}get radius(){return this.radiusX}set radius(t){this.radiusX=t}get width(){return super.width}get height(){return super.height}set width(t){super.width=t,super.height=t}set height(t){this.width=t}},Rectangle:class extends F{constructor(t){if(super(t=t||{}),this.radius=t.radius||0,this.radius<0)throw new Error("radius should bigger than zero")}defineShapePath(t){if(0==this.radius)t.rect(0,0,this.width,this.height);else{let e=Math.min(this.width,this.height);if(this.radius>e/2)throw new Error("radius should less than half of width or height");t.moveTo(this.radius,0),t.lineTo(this.width-this.radius,0),t.arc(this.width-this.radius,this.radius,this.radius,-Math.PI/2,0),t.lineTo(this.width,this.height-this.radius),t.arc(this.width-this.radius,this.height-this.radius,this.radius,0,Math.PI/2),t.lineTo(this.radius,this.height),t.arc(this.radius,this.height-this.radius,this.radius,Math.PI/2,Math.PI),t.lineTo(0,this.radius),t.arc(this.radius,this.radius,this.radius,Math.PI,Math.PI+Math.PI/2)}}}},geometry:{SAT:j},physics:{PhysicsModel:Y},spirit:{TestRectSpirit:class extends mt{constructor(t){super(t),this.color=t.color||"white"}drawSelf(t){t.beginPath(),t.rect(0,0,this.width,this.height),t.fillStyle=this.color,t.fill()}},Spirit:class extends mt{get texture(){return this.defaultTexture}set texture(t){this.defaultTexture=t}get textureIndex(){return this._defaultTextureIndex}set textureIndex(t){this._defaultTextureIndex=t}constructor(t){super(t),null==t&&(t={}),this.targetTop=t.targetTop||0,this.targetLeft=t.targetLeft||0,this.targetWidth=t.targetWidth||0,this.targetHeight=t.targetHeight||0,t.texture&&(this._texture=t.texture,this.defaultTexture=t.texture),this._textureIndex=-1,this._defaultTextureIndex=-1,this.sheetAnimationMap={},this.currentAnimation={key:null,animation:new Et(this)},null!=t.textureIndex&&(this._textureIndex=t.textureIndex,this._defaultTextureIndex=t.textureIndex)}addSheetAnimation(t){if(t){let e=t.key,i=t.start,r=t.end,n=t.time||500,a=t.loop||!1,s=t._texture;this.sheetAnimationMap[e]={start:i,end:r+.9,time:n,loop:a,texture:s}}}removeSheetAnimation(t){this.sheetAnimationMap[t]=void 0}get currentSheetAnimationPaused(){return this.currentAnimation.animation.paused}get currentSheetAnimationRunning(){return this.currentAnimation.animation.isRunning}get currentSheetAnimation(){return this.currentAnimation}playCurrentSheetAnimation(t){null!=this.currentAnimation.key&&this.playSheetAnimation(this.currentAnimation.key,t)}playSheetAnimation(t,e){if(this.currentAnimation.key===t){if(this.currentAnimation.animation.isRunning)return;if(this.currentAnimation.animation.paused)return void this.currentAnimation.animation.start()}let i=this.sheetAnimationMap[t];if(i){this.currentAnimation.key=t;let r=this.currentAnimation.animation;r.totalTime=i.time,i.loop&&(r.loop=-1),this._textureIndex=i.start,null!=r.texture&&(this._texture=r.texture),r.propertyChangeTo(i.end,"_textureIndex");let n=this;r.start({complete:function(){n._texture=n.defaultTexture,n._textureIndex=n._defaultTextureIndex,e&&e.complete&&e.complete()},stop:function(){n._texture=n.defaultTexture,n._textureIndex=n._defaultTextureIndex,e&&e.stop&&e.stop()}})}}pauseCurrentSheetAnimation(){this.currentAnimation.animation.isRunning&&this.currentAnimation.animation.pause()}stopCurrentSheetAnimation(){this.currentAnimation.animation.isRunning&&this.currentAnimation.animation.interrupt()}drawSelf(t){if(null==this._texture&&(this._texture=this.defaultTexture),null==this._texture)return;let e=this._texture;-1!=this._textureIndex&&(e=this._texture.splitedTextures[Math.floor(this._textureIndex)]),null!=e&&(0==this.targetWidth||0==this.targetHeight?t.drawImage(e,0,0,this.width,this.height):t.drawImage(e,this.targetLeft,this.targetTop,this.targetWidth,this.targetHeight,0,0,this.width,this.height))}}},World:class extends L{constructor(t,e){let i=(e=e||{}).gridRow||10,r=e.gridColumn||10;super(t),this.collisionE=e.e||1,this.uniformGrid=new Mt(i,r,this.width,this.height),this.showDebug=e.showDebug||!1}contactTest(){for(let t=0;t<this.childrenSize;t++){let e=this.getChild(t);for(let t=0;t<this.childrenSize;t++){let i=this.getChild(t);e.overlap&&e.overlap(i)}}}monitorSpiritBeforeMove(t){t.figure}monitorSpiritAfterMove(t){let e,i=t.figure,r=i.getGraph(),n=i.physicsModel;if(i.isTransformChanged&&r.uniformGrid&&r.uniformGrid.updateRegionsOfFigure(i),i.contactable&&null!=n){if(e=[],!i.isSleeping){let t=i.relatedRegions;for(let s=0;s<t.length;s++){let l=t[s],u=r.uniformGrid.getRegion(l);for(let t=0;t<u.relatedFigures.length;t++){let r=u.relatedFigures.get(t);if(r!=i&&null!=r.physicsModel&&!a(r,i)&&(e.push({s:i,t:r}),h.overlaps(i.getSelectBounds(),r.getSelectBounds()))){let t=n,e=r.physicsModel;t.applyCurrentTransform(i.absoluteRotate,i.getTransformMatrix()),e.applyCurrentTransform(r.absoluteRotate,r.getTransformMatrix());let a=j.collisionTest(t,e);a.collision&&Pt.solveCollision(i,r,a.centerA,a.centerB,a.verticesA,a.verticesB,a.contactPoints,a.contactPlane,a.MTV.direction,this.collisionE,a.MTV.minOverlap.value)}}}}e.length=0}function a(t,i){for(let r=0;r<e.length;r++){let n=e[r];if(n.s==t&&n.t==i)return!0;if(n.s==i&&n.t==t)return!0}let r={};return r.s=t,r.t=i,e.push(r),!1}}startWorld(){for(let t=0;t<this.children.length;t++){let e=this.getChild(t);e instanceof mt&&(this.uniformGrid.updateRegionsOfFigure(e),e.isStaticFigure||e.startMove())}this.startLoopRefresh()}update(t){super.update(t),this.showDebug&&this._debug_drawPhysicsModel()}_debug_drawPhysicsModel(){this.ctx.save(),this.ctx.strokeStyle="red";for(let t=0;t<this.children.length;t++){let e=this.getChild(t).physicsModel;if(e){this.ctx.beginPath(),this.ctx.moveTo(e.vertices[0].x,e.vertices[0].y);for(let t=1;t<e.vertices.length;t++){let i=e.vertices[t];this.ctx.lineTo(i.x,i.y)}this.ctx.closePath();let t=10;for(let i=0;i<e.axis.length;i++){let r=e.axis[i];this.ctx.moveTo(e.center.x,e.center.y);let n=r.x*t,a=r.y*t;this.ctx.lineTo(e.center.x+n,e.center.y+a)}this.ctx.stroke()}}this.ctx.restore()}},Figure:V},Ft);e.default=Ft}]).default});